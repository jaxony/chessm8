!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/Users/Jackson/chessm8/src/client/static",n(n.s=30)}([function(t,e){var n,r,o=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(t){n=i}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var c,u=[],l=!1,f=-1;function p(){l&&c&&(l=!1,c.length?u=c.concat(u):f=-1,u.length&&h())}function h(){if(!l){var t=a(p);l=!0;for(var e=u.length;e;){for(c=u,u=[];++f<e;)c&&c[f].run();f=-1,e=u.length}c=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function v(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new d(t,e)),1!==u.length||l||a(h)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=v,o.addListener=v,o.once=v,o.off=v,o.removeListener=v,o.removeAllListeners=v,o.emit=v,o.prependListener=v,o.prependOnceListener=v,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){e.endianness=function(){return"LE"},e.hostname=function(){return"undefined"!=typeof location?location.hostname:""},e.loadavg=function(){return[]},e.uptime=function(){return 0},e.freemem=function(){return Number.MAX_VALUE},e.totalmem=function(){return Number.MAX_VALUE},e.cpus=function(){return[]},e.type=function(){return"Browser"},e.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},e.networkInterfaces=e.getNetworkInterfaces=function(){return{}},e.arch=function(){return"javascript"},e.platform=function(){return"browser"},e.tmpdir=e.tmpDir=function(){return"/tmp"},e.EOL="\n",e.homedir=function(){return"/"}},function(t,e,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
function r(t,e){if(t===e)return 0;for(var n=t.length,r=e.length,o=0,i=Math.min(n,r);o<i;++o)if(t[o]!==e[o]){n=t[o],r=e[o];break}return n<r?-1:r<n?1:0}function o(t){return e.Buffer&&"function"==typeof e.Buffer.isBuffer?e.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var i=n(26),s=Object.prototype.hasOwnProperty,a=Array.prototype.slice,c="foo"===function(){}.name;function u(t){return Object.prototype.toString.call(t)}function l(t){return!o(t)&&("function"==typeof e.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer))))}var f=t.exports=y,p=/\s*function\s+([^\(\s]*)\s*/;function h(t){if(i.isFunction(t)){if(c)return t.name;var e=t.toString().match(p);return e&&e[1]}}function d(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function v(t){if(c||!i.isFunction(t))return i.inspect(t);var e=h(t);return"[Function"+(e?": "+e:"")+"]"}function _(t,e,n,r,o){throw new f.AssertionError({message:n,actual:t,expected:e,operator:r,stackStartFunction:o})}function y(t,e){t||_(t,!0,e,"==",f.ok)}function g(t,e,n,s){if(t===e)return!0;if(o(t)&&o(e))return 0===r(t,e);if(i.isDate(t)&&i.isDate(e))return t.getTime()===e.getTime();if(i.isRegExp(t)&&i.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(l(t)&&l(e)&&u(t)===u(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===r(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(o(t)!==o(e))return!1;var c=(s=s||{actual:[],expected:[]}).actual.indexOf(t);return-1!==c&&c===s.expected.indexOf(e)||(s.actual.push(t),s.expected.push(e),function(t,e,n,r){if(null===t||void 0===t||null===e||void 0===e)return!1;if(i.isPrimitive(t)||i.isPrimitive(e))return t===e;if(n&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var o=m(t),s=m(e);if(o&&!s||!o&&s)return!1;if(o)return t=a.call(t),e=a.call(e),g(t,e,n);var c,u,l=E(t),f=E(e);if(l.length!==f.length)return!1;for(l.sort(),f.sort(),u=l.length-1;u>=0;u--)if(l[u]!==f[u])return!1;for(u=l.length-1;u>=0;u--)if(c=l[u],!g(t[c],e[c],n,r))return!1;return!0}(t,e,n,s))}return n?t===e:t==e}function m(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function b(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function w(t,e,n,r){var o;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),o=function(t){var e;try{t()}catch(t){e=t}return e}(e),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),t&&!o&&_(o,n,"Missing expected exception"+r);var s="string"==typeof r,a=!t&&i.isError(o),c=!t&&o&&!n;if((a&&s&&b(o,n)||c)&&_(o,n,"Got unwanted exception"+r),t&&o&&n&&!b(o,n)||!t&&o)throw o}f.AssertionError=function(t){var e;this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=d(v((e=this).actual),128)+" "+e.operator+" "+d(v(e.expected),128),this.generatedMessage=!0);var n=t.stackStartFunction||_;if(Error.captureStackTrace)Error.captureStackTrace(this,n);else{var r=new Error;if(r.stack){var o=r.stack,i=h(n),s=o.indexOf("\n"+i);if(s>=0){var a=o.indexOf("\n",s+1);o=o.substring(a+1)}this.stack=o}}},i.inherits(f.AssertionError,Error),f.fail=_,f.ok=y,f.equal=function(t,e,n){t!=e&&_(t,e,n,"==",f.equal)},f.notEqual=function(t,e,n){t==e&&_(t,e,n,"!=",f.notEqual)},f.deepEqual=function(t,e,n){g(t,e,!1)||_(t,e,n,"deepEqual",f.deepEqual)},f.deepStrictEqual=function(t,e,n){g(t,e,!0)||_(t,e,n,"deepStrictEqual",f.deepStrictEqual)},f.notDeepEqual=function(t,e,n){g(t,e,!1)&&_(t,e,n,"notDeepEqual",f.notDeepEqual)},f.notDeepStrictEqual=function t(e,n,r){g(e,n,!0)&&_(e,n,r,"notDeepStrictEqual",t)},f.strictEqual=function(t,e,n){t!==e&&_(t,e,n,"===",f.strictEqual)},f.notStrictEqual=function(t,e,n){t===e&&_(t,e,n,"!==",f.notStrictEqual)},f.throws=function(t,e,n){w(!0,t,e,n)},f.doesNotThrow=function(t,e,n){w(!1,t,e,n)},f.ifError=function(t){if(t)throw t};var E=Object.keys||function(t){var e=[];for(var n in t)s.call(t,n)&&e.push(n);return e}}).call(this,n(1))},function(t,e){t.exports={INVALID_MODE:"INVALID MODE",REWARD_REMOVAL_EXCEPTION:"Cannot remove a reward that does not exist.",INVALID_REWARD:"Reward id does not match any of those defined in rewards.js"}},function(t,e){t.exports={NORMAL:"NORMAL",RANK:"RANK",AFTER_RANK:"AFTER_RANK",GUESS:"GUESS",OPPONENT:"OPPONENT"}},function(t,e,n){(function(e,n){
/*!
 *
 * Copyright 2009-2017 Kris Kowal under the terms of the MIT
 * license found at https://github.com/kriskowal/q/blob/v1/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
!function(e){"use strict";"function"==typeof bootstrap?bootstrap("promise",e):t.exports=e()}(function(){"use strict";var t=!1;try{throw new Error}catch(e){t=!!e.stack}var r,o=C(),i=function(){},s=function(){var t={task:void 0,next:null},r=t,o=!1,i=void 0,a=!1,c=[];function u(){for(var e,n;t.next;)e=(t=t.next).task,t.task=void 0,(n=t.domain)&&(t.domain=void 0,n.enter()),l(e,n);for(;c.length;)l(e=c.pop());o=!1}function l(t,e){try{t()}catch(t){if(a)throw e&&e.exit(),setTimeout(u,0),e&&e.enter(),t;setTimeout(function(){throw t},0)}e&&e.exit()}if(s=function(t){r=r.next={task:t,domain:a&&e.domain,next:null},o||(o=!0,i())},"object"==typeof e&&"[object process]"===e.toString()&&e.nextTick)a=!0,i=function(){e.nextTick(u)};else if("function"==typeof n)i="undefined"!=typeof window?n.bind(window,u):function(){n(u)};else if("undefined"!=typeof MessageChannel){var f=new MessageChannel;f.port1.onmessage=function(){i=p,f.port1.onmessage=u,u()};var p=function(){f.port2.postMessage(0)};i=function(){setTimeout(u,0),p()}}else i=function(){setTimeout(u,0)};return s.runAfter=function(t){c.push(t),o||(o=!0,i())},s}(),a=Function.call;function c(t){return function(){return a.apply(t,arguments)}}var u,l=c(Array.prototype.slice),f=c(Array.prototype.reduce||function(t,e){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=r)throw new TypeError}for(;n<r;n++)n in this&&(e=t(e,this[n],n));return e}),p=c(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),h=c(Array.prototype.map||function(t,e){var n=this,r=[];return f(n,function(o,i,s){r.push(t.call(e,i,s,n))},void 0),r}),d=Object.create||function(t){function e(){}return e.prototype=t,new e},v=Object.defineProperty||function(t,e,n){return t[e]=n.value,t},_=c(Object.prototype.hasOwnProperty),y=Object.keys||function(t){var e=[];for(var n in t)_(t,n)&&e.push(n);return e},g=c(Object.prototype.toString);u="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var m="From previous event:";function b(e,n){if(t&&n.stack&&"object"==typeof e&&null!==e&&e.stack){for(var r=[],o=n;o;o=o.source)o.stack&&(!e.__minimumStackCounter__||e.__minimumStackCounter__>o.stackCounter)&&(v(e,"__minimumStackCounter__",{value:o.stackCounter,configurable:!0}),r.unshift(o.stack));r.unshift(e.stack);var i=function(t){for(var e=t.split("\n"),n=[],r=0;r<e.length;++r){var o=e[r];!E(o)&&(-1===(i=o).indexOf("(module.js:")&&-1===i.indexOf("(node.js:"))&&o&&n.push(o)}var i;return n.join("\n")}(r.join("\n"+m+"\n"));v(e,"stack",{value:i,configurable:!0})}}function w(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(t);return r?[r[1],Number(r[2])]:void 0}function E(t){var e=w(t);if(!e)return!1;var n=e[0],i=e[1];return n===r&&i>=o&&i<=W}function C(){if(t)try{throw new Error}catch(t){var e=t.stack.split("\n"),n=w(e[0].indexOf("@")>0?e[1]:e[2]);if(!n)return;return r=n[0],n[1]}}function k(t){return t instanceof S?t:F(t)?(e=t,n=P(),k.nextTick(function(){try{e.then(n.resolve,n.reject,n.notify)}catch(t){n.reject(t)}}),n.promise):Q(t);var e,n}k.resolve=k,k.nextTick=s,k.longStackSupport=!1;var j=1;function P(){var e,n=[],r=[],o=d(P.prototype),i=d(S.prototype);if(i.promiseDispatch=function(t,o,i){var s=l(arguments);n?(n.push(s),"when"===o&&i[1]&&r.push(i[1])):k.nextTick(function(){e.promiseDispatch.apply(e,s)})},i.valueOf=function(){if(n)return i;var t=O(e);return A(t)&&(e=t),t},i.inspect=function(){return e?e.inspect():{state:"pending"}},k.longStackSupport&&t)try{throw new Error}catch(t){i.stack=t.stack.substring(t.stack.indexOf("\n")+1),i.stackCounter=j++}function s(o){e=o,k.longStackSupport&&t&&(i.source=o),f(n,function(t,e){k.nextTick(function(){o.promiseDispatch.apply(o,e)})},void 0),n=void 0,r=void 0}return o.promise=i,o.resolve=function(t){e||s(k(t))},o.fulfill=function(t){e||s(Q(t))},o.reject=function(t){e||s(U(t))},o.notify=function(t){e||f(r,function(e,n){k.nextTick(function(){n(t)})},void 0)},o}function T(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=P();try{t(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}return e.promise}function x(t){return T(function(e,n){for(var r=0,o=t.length;r<o;r++)k(t[r]).then(e,n)})}function S(t,e,n){void 0===e&&(e=function(t){return U(new Error("Promise does not support operation: "+t))}),void 0===n&&(n=function(){return{state:"unknown"}});var r=d(S.prototype);if(r.promiseDispatch=function(n,o,i){var s;try{s=t[o]?t[o].apply(r,i):e.call(r,o,i)}catch(t){s=U(t)}n&&n(s)},r.inspect=n,n){var o=n();"rejected"===o.state&&(r.exception=o.reason),r.valueOf=function(){var t=n();return"pending"===t.state||"rejected"===t.state?r:t.value}}return r}function R(t,e,n,r){return k(t).then(e,n,r)}function O(t){if(A(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function A(t){return t instanceof S}function F(t){return(e=t)===Object(e)&&"function"==typeof t.then;var e}"object"==typeof e&&e&&e.env&&e.env.Q_DEBUG&&(k.longStackSupport=!0),k.defer=P,P.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):arguments.length>2?t.resolve(l(arguments,1)):t.resolve(n)}},k.Promise=T,k.promise=T,T.race=x,T.all=K,T.reject=U,T.resolve=k,k.passByCopy=function(t){return t},S.prototype.passByCopy=function(){return this},k.join=function(t,e){return k(t).join(e)},S.prototype.join=function(t){return k([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Q can't join: not the same: "+t+" "+e)})},k.race=x,S.prototype.race=function(){return this.then(k.race)},k.makePromise=S,S.prototype.toString=function(){return"[object Promise]"},S.prototype.then=function(t,e,n){var r=this,o=P(),i=!1;return k.nextTick(function(){r.promiseDispatch(function(e){i||(i=!0,o.resolve(function(e){try{return"function"==typeof t?t(e):e}catch(t){return U(t)}}(e)))},"when",[function(t){i||(i=!0,o.resolve(function(t){if("function"==typeof e){b(t,r);try{return e(t)}catch(t){return U(t)}}return U(t)}(t)))}])}),r.promiseDispatch(void 0,"when",[void 0,function(t){var e,r=!1;try{e=function(t){return"function"==typeof n?n(t):t}(t)}catch(t){if(r=!0,!k.onerror)throw t;k.onerror(t)}r||o.notify(e)}]),o.promise},k.tap=function(t,e){return k(t).tap(e)},S.prototype.tap=function(t){return t=k(t),this.then(function(e){return t.fcall(e).thenResolve(e)})},k.when=R,S.prototype.thenResolve=function(t){return this.then(function(){return t})},k.thenResolve=function(t,e){return k(t).thenResolve(e)},S.prototype.thenReject=function(t){return this.then(function(){throw t})},k.thenReject=function(t,e){return k(t).thenReject(e)},k.nearer=O,k.isPromise=A,k.isPromiseAlike=F,k.isPending=function(t){return A(t)&&"pending"===t.inspect().state},S.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=function(t){return!A(t)||"fulfilled"===t.inspect().state},S.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=function(t){return A(t)&&"rejected"===t.inspect().state},S.prototype.isRejected=function(){return"rejected"===this.inspect().state};var I,M,N,D=[],L=[],B=[],q=!0;function V(){D.length=0,L.length=0,q||(q=!0)}function U(t){var n=S({when:function(n){return n&&function(t){if(q){var n=p(L,t);-1!==n&&("object"==typeof e&&"function"==typeof e.emit&&k.nextTick.runAfter(function(){var r=p(B,t);-1!==r&&(e.emit("rejectionHandled",D[n],t),B.splice(r,1))}),L.splice(n,1),D.splice(n,1))}}(this),n?n(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return function(t,n){q&&("object"==typeof e&&"function"==typeof e.emit&&k.nextTick.runAfter(function(){-1!==p(L,t)&&(e.emit("unhandledRejection",n,t),B.push(t))}),L.push(t),n&&void 0!==n.stack?D.push(n.stack):D.push("(no stack) "+n))}(n,t),n}function Q(t){return S({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},delete:function(e){delete t[e]},post:function(e,n){return null===e||void 0===e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return y(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function H(t,e,n){return k(t).spread(e,n)}function $(t,e,n){return k(t).dispatch(e,n)}function K(t){return R(t,function(t){var e=0,n=P();return f(t,function(r,o,i){var s;A(o)&&"fulfilled"===(s=o.inspect()).state?t[i]=s.value:(++e,R(o,function(r){t[i]=r,0==--e&&n.resolve(t)},n.reject,function(t){n.notify({index:i,value:t})}))},void 0),0===e&&n.resolve(t),n.promise})}function z(t){if(0===t.length)return k.resolve();var e=k.defer(),n=0;return f(t,function(r,o,i){var s=t[i];n++,R(s,function(t){e.resolve(t)},function(t){if(0==--n){var r=t||new Error(""+t);r.message="Q can't get fulfillment value from any promise, all promises were rejected. Last error message: "+r.message,e.reject(r)}},function(t){e.notify({index:i,value:t})})},void 0),e.promise}function G(t){return R(t,function(t){return t=h(t,k),R(K(h(t,function(t){return R(t,i,i)})),function(){return t})})}k.resetUnhandledRejections=V,k.getUnhandledReasons=function(){return D.slice()},k.stopUnhandledRejectionTracking=function(){V(),q=!1},V(),k.reject=U,k.fulfill=Q,k.master=function(t){return S({isDef:function(){}},function(e,n){return $(t,e,n)},function(){return k(t).inspect()})},k.spread=H,S.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},k.async=function(t){return function(){function e(t,e){var i;if("undefined"==typeof StopIteration){try{i=n[t](e)}catch(t){return U(t)}return i.done?k(i.value):R(i.value,r,o)}try{i=n[t](e)}catch(t){return function(t){return"[object StopIteration]"===g(t)||t instanceof u}(t)?k(t.value):U(t)}return R(i,r,o)}var n=t.apply(this,arguments),r=e.bind(e,"next"),o=e.bind(e,"throw");return r()}},k.spawn=function(t){k.done(k.async(t)())},k.return=function(t){throw new u(t)},k.promised=function(t){return function(){return H([this,K(arguments)],function(e,n){return t.apply(e,n)})}},k.dispatch=$,S.prototype.dispatch=function(t,e){var n=this,r=P();return k.nextTick(function(){n.promiseDispatch(r.resolve,t,e)}),r.promise},k.get=function(t,e){return k(t).dispatch("get",[e])},S.prototype.get=function(t){return this.dispatch("get",[t])},k.set=function(t,e,n){return k(t).dispatch("set",[e,n])},S.prototype.set=function(t,e){return this.dispatch("set",[t,e])},k.del=k.delete=function(t,e){return k(t).dispatch("delete",[e])},S.prototype.del=S.prototype.delete=function(t){return this.dispatch("delete",[t])},k.mapply=k.post=function(t,e,n){return k(t).dispatch("post",[e,n])},S.prototype.mapply=S.prototype.post=function(t,e){return this.dispatch("post",[t,e])},k.send=k.mcall=k.invoke=function(t,e){return k(t).dispatch("post",[e,l(arguments,2)])},S.prototype.send=S.prototype.mcall=S.prototype.invoke=function(t){return this.dispatch("post",[t,l(arguments,1)])},k.fapply=function(t,e){return k(t).dispatch("apply",[void 0,e])},S.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},k.try=k.fcall=function(t){return k(t).dispatch("apply",[void 0,l(arguments,1)])},S.prototype.fcall=function(){return this.dispatch("apply",[void 0,l(arguments)])},k.fbind=function(t){var e=k(t),n=l(arguments,1);return function(){return e.dispatch("apply",[this,n.concat(l(arguments))])}},S.prototype.fbind=function(){var t=this,e=l(arguments);return function(){return t.dispatch("apply",[this,e.concat(l(arguments))])}},k.keys=function(t){return k(t).dispatch("keys",[])},S.prototype.keys=function(){return this.dispatch("keys",[])},k.all=K,S.prototype.all=function(){return K(this)},k.any=z,S.prototype.any=function(){return z(this)},k.allResolved=(I=G,M="allResolved",N="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(M+" is deprecated, use "+N+" instead.",new Error("").stack),I.apply(I,arguments)}),S.prototype.allResolved=function(){return G(this)},k.allSettled=function(t){return k(t).allSettled()},S.prototype.allSettled=function(){return this.then(function(t){return K(h(t,function(t){function e(){return t.inspect()}return(t=k(t)).then(e,e)}))})},k.fail=k.catch=function(t,e){return k(t).then(void 0,e)},S.prototype.fail=S.prototype.catch=function(t){return this.then(void 0,t)},k.progress=function(t,e){return k(t).then(void 0,void 0,e)},S.prototype.progress=function(t){return this.then(void 0,void 0,t)},k.fin=k.finally=function(t,e){return k(t).finally(e)},S.prototype.fin=S.prototype.finally=function(t){if(!t||"function"!=typeof t.apply)throw new Error("Q can't apply finally callback");return t=k(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},k.done=function(t,e,n,r){return k(t).done(e,n,r)},S.prototype.done=function(t,n,r){var o=function(t){k.nextTick(function(){if(b(t,i),!k.onerror)throw t;k.onerror(t)})},i=t||n||r?this.then(t,n,r):this;"object"==typeof e&&e&&e.domain&&(o=e.domain.bind(o)),i.then(void 0,o)},k.timeout=function(t,e,n){return k(t).timeout(e,n)},S.prototype.timeout=function(t,e){var n=P(),r=setTimeout(function(){e&&"string"!=typeof e||((e=new Error(e||"Timed out after "+t+" ms")).code="ETIMEDOUT"),n.reject(e)},t);return this.then(function(t){clearTimeout(r),n.resolve(t)},function(t){clearTimeout(r),n.reject(t)},n.notify),n.promise},k.delay=function(t,e){return void 0===e&&(e=t,t=void 0),k(t).delay(e)},S.prototype.delay=function(t){return this.then(function(e){var n=P();return setTimeout(function(){n.resolve(e)},t),n.promise})},k.nfapply=function(t,e){return k(t).nfapply(e)},S.prototype.nfapply=function(t){var e=P(),n=l(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},k.nfcall=function(t){var e=l(arguments,1);return k(t).nfapply(e)},S.prototype.nfcall=function(){var t=l(arguments),e=P();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},k.nfbind=k.denodeify=function(t){if(void 0===t)throw new Error("Q can't wrap an undefined function");var e=l(arguments,1);return function(){var n=e.concat(l(arguments)),r=P();return n.push(r.makeNodeResolver()),k(t).fapply(n).fail(r.reject),r.promise}},S.prototype.nfbind=S.prototype.denodeify=function(){var t=l(arguments);return t.unshift(this),k.denodeify.apply(void 0,t)},k.nbind=function(t,e){var n=l(arguments,2);return function(){var r=n.concat(l(arguments)),o=P();return r.push(o.makeNodeResolver()),k(function(){return t.apply(e,arguments)}).fapply(r).fail(o.reject),o.promise}},S.prototype.nbind=function(){var t=l(arguments,0);return t.unshift(this),k.nbind.apply(void 0,t)},k.nmapply=k.npost=function(t,e,n){return k(t).npost(e,n)},S.prototype.nmapply=S.prototype.npost=function(t,e){var n=l(e||[]),r=P();return n.push(r.makeNodeResolver()),this.dispatch("post",[t,n]).fail(r.reject),r.promise},k.nsend=k.nmcall=k.ninvoke=function(t,e){var n=l(arguments,2),r=P();return n.push(r.makeNodeResolver()),k(t).dispatch("post",[e,n]).fail(r.reject),r.promise},S.prototype.nsend=S.prototype.nmcall=S.prototype.ninvoke=function(t){var e=l(arguments,1),n=P();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},k.nodeify=function(t,e){return k(t).nodeify(e)},S.prototype.nodeify=function(t){if(!t)return this;this.then(function(e){k.nextTick(function(){t(null,e)})},function(e){k.nextTick(function(){t(e)})})},k.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var W=C();return k})}).call(this,n(0),n(7).setImmediate)},function(t,e,n){(function(t){var r=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(r.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new o(r.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(19),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(1))},function(t,e,n){const r=n(3);t.exports={isInteger:function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},chessjsToChessboard:function(t){return t.from+"-"+t.to},parseCentipawnEvaluation:function(t){r(null!==t);var e=/cp (-?[0-9]+)/.exec(t);return e?e[1]:-1e5},convertObjectToArray:function(t){const e=new Array;for(var n in t)t.hasOwnProperty(n)&&e.push({playerRank:parseInt(n),from:t[n].from,to:t[n].to,score:null});return e},sortMovesByScore:function(t){t.sort(function(t,e){return t.score<e.score?-1:t.score===e.score?0:1})},getScoreEmoji:function(t){return r("number"==typeof t),t<0?"ðŸ˜”":t<50?"Nice! âœ…":t<100?"Great! ðŸŽ‰":100===t?"ðŸ’¯":"ðŸ”¥ðŸš€ðŸ™Œ"},isCorrectRanking:function(t){if(t.length<2)return!1;for(var e=1;e<t.length;e++){const n=t[e-1],r=t[e];if(n.playerRank<r.playerRank)return!1}return!0}}},function(t,e){var n=function(t){this.$rewardsPanel=$("#"+t)};n.prototype.addReward=function(t,e){(function(t,e){return $('<div class="reward '+t+'" data="'+t+'" title="'+e+'"><img src="./img/rewards/'+t+'.png"/></div>').draggable({revert:"invalid"}).tooltip({show:{delay:1e3}})})(t,e).hide().appendTo(this.$rewardsPanel).fadeIn(250)},n.prototype.removeReward=function(t){$(t).fadeOut(250,function(){$(this).remove()})},t.exports=n},function(t,e){!function(){"use strict";if(!window.jQuery)throw console.log("jQuery not found!"),"jQuery not in window!";console.log("jQuery found!");var e=window.jQuery,n="abcdefgh".split(""),r=20,o="â€¦",i="1.8.3",s="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",a=O(s),c=200,u=200,l=60,f=30,p=100,h=300,d=500,v={};function _(t,e,n){var r=0,o=!1,i=[],s=function(){r=0,o&&(o=!1,a())},a=function(){r=window.setTimeout(s,e),t.apply(n,i)};return function(t){i=arguments,r?o=!0:a()}}function y(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(t){return(16*Math.random()|0).toString(16)})}function g(t){return JSON.parse(JSON.stringify(t))}function m(t){var e=t.split(".");return{major:parseInt(e[0],10),minor:parseInt(e[1],10),patch:parseInt(e[2],10)}}function b(t,e){for(var n in e)if(e.hasOwnProperty(n))for(var r="{"+n+"}",o=e[n];-1!==t.indexOf(r);)t=t.replace(r,o);return t}function w(t){return"string"==typeof t}function E(t){return"function"==typeof t}function C(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}function k(t){return"fast"===t||"slow"===t||!!C(t)&&t>=0}function j(t){if(!w(t))return!1;var e=t.split("-");return 2===e.length&&(P(e[0])&&P(e[1]))}function P(t){return w(t)&&-1!==t.search(/^[a-h][1-8]$/)}function T(t){return w(t)&&-1!==t.search(/^[bw][KQRNBP]$/)}function x(t){if(!w(t))return!1;var e=(t=function(t){return t.replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11")}(t=t.replace(/ .+$/,""))).split("/");if(8!==e.length)return!1;for(var n=0;n<8;n++)if(8!==e[n].length||-1!==e[n].search(/[^kqrnbpKQRNBP1]/))return!1;return!0}function S(t){if(!e.isPlainObject(t))return!1;for(var n in t)if(t.hasOwnProperty(n)&&(!P(n)||!T(t[n])))return!1;return!0}function R(){return typeof window.$&&e.fn&&e.fn.jquery&&(t=e.fn.jquery,n=i,t=m(t),n=m(n),1e5*t.major*1e5+1e5*t.minor+t.patch>=1e5*n.major*1e5+1e5*n.minor+n.patch);var t,n}function O(t){if(!x(t))return!1;for(var e,r=(t=t.replace(/ .+$/,"")).split("/"),o={},i=8,s=0;s<8;s++){for(var a=r[s].split(""),c=0,u=0;u<a.length;u++){if(-1!==a[u].search(/[1-8]/))c+=parseInt(a[u],10);else o[n[c]+i]=(e=a[u]).toLowerCase()===e?"b"+e.toUpperCase():"w"+e.toUpperCase(),c+=1}i-=1}return o}function A(t){if(!S(t))return!1;for(var e,r,o="",i=8,s=0;s<8;s++){for(var a=0;a<8;a++){var c=n[a]+i;t.hasOwnProperty(c)?o+=(e=t[c],r=void 0,"w"===(r=e.split(""))[0]?r[1].toUpperCase():r[1].toLowerCase()):o+="1"}7!==s&&(o+="/"),i-=1}return o=function(t){return t.replace(/11111111/g,"8").replace(/1111111/g,"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2")}(o)}function F(t,e,r){for(var o=function(t){for(var e=[],r=0;r<8;r++)for(var o=0;o<8;o++){var i=n[r]+(o+1);t!==i&&e.push({square:i,distance:(s=t,a=i,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,c=s.split(""),u=n.indexOf(c[0])+1,l=parseInt(c[1],10),f=a.split(""),p=n.indexOf(f[0])+1,h=parseInt(f[1],10),d=Math.abs(u-p),v=Math.abs(l-h),d>=v?d:v)})}var s,a,c,u,l,f,p,h,d,v;e.sort(function(t,e){return t.distance-e.distance});var _=[];for(r=0;r<e.length;r++)_.push(e[r].square);return _}(r),i=0;i<o.length;i++){var s=o[i];if(t.hasOwnProperty(s)&&t[s]===e)return s}return!1}function I(t){var e;return"black"!==t.orientation&&(t.orientation="white"),!1!==t.showNotation&&(t.showNotation=!0),!0!==t.draggable&&(t.draggable=!1),"trash"!==t.dropOffBoard&&(t.dropOffBoard="snapback"),!0!==t.sparePieces&&(t.sparePieces=!1),t.sparePieces&&(t.draggable=!0),t.hasOwnProperty("pieceTheme")&&(w(t.pieceTheme)||E(t.pieceTheme))||(t.pieceTheme="img/chesspieces/wikipedia/{piece}.png"),k(t.appearSpeed)||(t.appearSpeed=c),k(t.moveSpeed)||(t.moveSpeed=u),k(t.snapbackSpeed)||(t.snapbackSpeed=l),k(t.snapSpeed)||(t.snapSpeed=f),k(t.trashSpeed)||(t.trashSpeed=p),C(e=t.dragThrottleRate)&&e>=1||(t.dragThrottleRate=r),t}function M(t,r){if(!function(){if(!R()){var t="Chessboard Error 1005: Unable to find a valid version of jQuery. Please include jQuery "+i+" or higher on the page\n\nExiting"+o;return window.alert(t),!1}return!0}())return null;var s=function(t){if(""===t){var n="Chessboard Error 1001: The first argument to Chessboard() cannot be an empty string.\n\nExiting"+o;return window.alert(n),!1}w(t)&&"#"!==t.charAt(0)&&(t="#"+t);var r=e(t);if(1!==r.length){var i="Chessboard Error 1003: The first argument to Chessboard() must be the ID of a DOM node, an ID query selector, or a single DOM node.\n\nExiting"+o;return window.alert(i),!1}return r}(t);if(!s)return null;r=I(r=function(t){return"start"===t?t={position:g(a)}:x(t)?t={position:O(t)}:S(t)&&(t={position:g(t)}),e.isPlainObject(t)||(t={}),t}(r));var c=null,u=null,l=null,f=null,p=null,m={},k=2,T="white",M={},N=null,D=null,L=null,B=!1,q=!1,V={},U={},Q={},H=16,$=!1,K={},z=0,G=!1;function W(t,e,n){if(!0===r.hasOwnProperty("showErrors")&&!1!==r.showErrors){var o="Chessboard Error "+t+": "+e;return"console"===r.showErrors&&"object"==typeof console&&"function"==typeof console.log?(console.log(o),void(arguments.length>=2&&console.log(n))):"alert"===r.showErrors?(n&&(o+="\n\n"+JSON.stringify(n)),void window.alert(o)):void(E(r.showErrors)&&r.showErrors(t,e,n))}}function X(t){return E(r.pieceTheme)?r.pieceTheme(t):w(r.pieceTheme)?b(r.pieceTheme,{piece:t}):(W(8272,"Unable to build image source for config.pieceTheme."),"")}function Y(t,e,n){var r='<img src="'+X(t)+'" ';return w(n)&&""!==n&&(r+='id="'+n+'" '),r+='alt="" class="{piece}" data-piece="'+t+'" style="width:'+H+"px;height:"+H+"px;",e&&(r+="display:none;"),b(r+='" />',v)}function J(t){var e=["wK","wQ","wR","wB","wN","wP"];"black"===t&&(e=["bK","bQ","bR","bB","bN","bP"]);for(var n="",r=0;r<e.length;r++)n+=Y(e[r],!1,V[e[r]]);return n}function Z(t,n,o,i){var s=e("#"+U[t]),a=s.offset(),c=e("#"+U[n]),u=c.offset(),l=y();e("body").append(Y(o,!0,l));var f=e("#"+l);f.css({display:"",position:"absolute",top:a.top,left:a.left}),s.find("."+v.piece).remove();var p={duration:r.moveSpeed,complete:function(){c.append(Y(o)),f.remove(),E(i)&&i()}};f.animate(u,p)}function tt(t,n,o){var i=e("#"+V[t]).offset(),s=e("#"+U[n]),a=s.offset(),c=y();e("body").append(Y(t,!0,c));var u=e("#"+c);u.css({display:"",position:"absolute",left:i.left,top:i.top});var l={duration:r.moveSpeed,complete:function(){s.find("."+v.piece).remove(),s.append(Y(t)),u.remove(),E(o)&&o()}};u.animate(a,l)}function et(){for(var t in c.find("."+v.piece).remove(),M)M.hasOwnProperty(t)&&e("#"+U[t]).append(Y(M[t]))}function nt(){c.html(function(t){"black"!==t&&(t="white");var e="",o=g(n),i=8;"black"===t&&(o.reverse(),i=1);for(var s="white",a=0;a<8;a++){e+='<div class="{row}">';for(var c=0;c<8;c++){var u=o[c]+i;e+='<div class="{square} '+v[s]+" square-"+u+'" style="width:'+H+"px;height:"+H+'px;" id="'+U[u]+'" data-square="'+u+'">',r.showNotation&&(("white"===t&&1===i||"black"===t&&8===i)&&(e+='<div class="{notation} {alpha}">'+o[c]+"</div>"),0===c&&(e+='<div class="{notation} {numeric}">'+i+"</div>")),e+="</div>",s="white"===s?"black":"white"}e+='<div class="{clearfix}"></div></div>',s="white"===s?"black":"white","white"===t?i-=1:i+=1}return b(e,v)}(T,r.showNotation)),et(),r.sparePieces&&("white"===T?(l.html(J("black")),f.html(J("white"))):(l.html(J("white")),f.html(J("black"))))}function rt(t){var e=g(M),n=g(t);A(e)!==A(n)&&(E(r.onChange)&&r.onChange(e,n),M=t)}function ot(t,e){for(var n in Q)if(Q.hasOwnProperty(n)){var r=Q[n];if(t>=r.left&&t<r.left+H&&e>=r.top&&e<r.top+H)return n}return"offboard"}function it(){c.find("."+v.square).removeClass(v.highlight1+" "+v.highlight2)}function st(){it();var t=g(M);delete t[L],rt(t),et(),u.fadeOut(r.trashSpeed),B=!1}function at(t,e){return Math.min(t.charCodeAt(0),e.charCodeAt(0))}function ct(t,e){return Math.max(t.charCodeAt(0),e.charCodeAt(0))}function ut(t,e){return Math.min(t[1],e[1])}function lt(t,e){return Math.max(t[1],e[1])}function ft(t,e,n){var r,o,i,s=[];if(w(i=t)&&-1!==i.search(/^[bw]N$/)){var a=Math.abs(n.charCodeAt(0)-e.charCodeAt(0));if((f=Math.abs(n[1]-e[1]))>a)for(var c=ut(e,n);c<=lt(e,n);c++)s.push(e[0]+c);else for(var u=at(e,n);u<=ct(e,n);u++)s.push(String.fromCharCode(u)+e[1]);s.push(n)}else if(e[0]===n[0])for(c=ut(e,n);c<=lt(e,n);c++)s.push(e[0]+c);else if(e[1]===n[1])for(u=at(e,n);u<=ct(e,n);u++)s.push(String.fromCharCode(u)+e[1]);else if(r=e,o=n,Math.abs(o.charCodeAt(0)-r.charCodeAt(0))===Math.abs(parseInt(o[1])-parseInt(r[1]))){var l=e,f=(a=n.charCodeAt(0)>e.charCodeAt(0)?1:-1,parseInt(n[1])>parseInt(e[1])?1:-1);for(s.push(l);l!==n;){l=String.fromCharCode(l.charCodeAt(0)+a)+(parseInt(l[1])+f),s.push(l)}}return s}function pt(t){t.forEach(function(t){e("#"+U[t]).append(function(t,e){var n='<div class="shade square-'+t+" "+e+'" style="width:'+H+"px;height:"+(H+1)+'px;" id="shade-'+U[t]+'" data-square="'+t+'">';return b(n+="</div>",v)}(t,"choice-shade-"+z))})}function ht(t){it();var n=g(M);delete n[L],n[t]=N,rt(n),K[++z]={from:L,to:D};var o=e("#"+U[t]).offset();var i={duration:r.snapSpeed,complete:function(){var n,o,i,s;et(),u.css("display","none"),$&&(e("#"+U[t]).append((o=!1,i="choice-ghost-"+z,s='<img src="'+X(n=N)+'" ',w(i)&&""!==i&&(s+='id="'+i+'" '),s+='alt="" class="{ghost}" data-piece="'+n+'" style="width:'+H+"px;height:"+H+"px;",o&&(s+="display:none;"),b(s+='" />',v))),pt(ft(N,L,t))),E(r.onSnapEnd)&&r.onSnapEnd(L,t,N)}};u.animate(o,i),B=!1}function dt(t,n,o,i){E(r.onDragStart)&&!1===r.onDragStart(t,n,g(M),T)||(B=!0,N=n,L=t,D="spare"===t?"offboard":t,function(){for(var t in Q={},U)U.hasOwnProperty(t)&&(Q[t]=e("#"+U[t]).offset())}(),u.attr("src",X(n)).css({display:"",position:"absolute",left:o-H/2,top:i-H/2}),"spare"!==t&&e("#"+U[t]).addClass(v.highlight1).find("."+v.piece).css("display","none"))}function vt(t,n){u.css({left:t-H/2,top:n-H/2});var o=ot(t,n);o!==D&&(P(D)&&e("#"+U[D]).removeClass(v.highlight2),P(o)&&e("#"+U[o]).addClass(v.highlight2),E(r.onDragMove)&&r.onDragMove(o,D,L,N,g(M),T),D=o)}function _t(t){for(var e=t.className.split(/\s+/),n=0;n<e.length;n++)if(-1!==e[n].indexOf("choice"))return e[n]}function yt(){q=!1,p=null}function gt(t,n,r){t.each(function(t,o){e(o).removeClass(n),e(o).addClass(r)})}function mt(t){return t[t.length-1]}function bt(t){if(P(t)){var n=e("#"+U[t]).find(".shade");if(0!==n.length){var r,o,i,s,a,c,u,l,f=_t(p),h=_t(n[0]);if(f!==h)o=h,i=e("."+(r=f)),s=e("."+o),gt(i,r,o),gt(s,o,r),a=f.replace("shade","ghost"),c=h.replace("shade","ghost"),u=e("#"+a),l=e("#"+c),u.attr("id",c),l.attr("id",a),function(t,e){if(K[t]&&K[e]){var n=K[t];K[t]=K[e],K[e]=n}}(mt(f),mt(h)),yt();else yt()}else yt()}else yt()}function wt(t){var n="drop";if("offboard"===t&&"snapback"===r.dropOffBoard&&(n="snapback"),"offboard"===t&&"trash"===r.dropOffBoard&&(n="trash"),E(r.onDrop)){var o=g(M);"spare"===L&&P(t)&&(o[t]=N),P(L)&&"offboard"===t&&delete o[L],P(L)&&P(t)&&(delete o[L],o[t]=N);var i=g(M),s=r.onDrop(L,t,N,o,i,T);"snapback"!==s&&"trash"!==s||(n=s)}"snapback"===n?function(){if("spare"!==L){it();var t=e("#"+U[L]).offset(),n={duration:r.snapbackSpeed,complete:function(){et(),u.css("display","none"),E(r.onSnapbackEnd)&&r.onSnapbackEnd(N,L,g(M),T)}};u.animate(t,n),B=!1}else st()}():"trash"===n?st():"drop"===n&&ht(t)}function Et(t){t.preventDefault()}function Ct(t){if(r.draggable){var n,o=e(this).attr("data-square");if(P(o))if(M.hasOwnProperty(o)&&dt(o,M[o],t.pageX,t.pageY),G){var i=e("#"+U[o]).find(".shade");i.length>0&&(n=i[0],q=!0,p=n)}}}function kt(t,n){C(n)&&e(t).fadeOut(n,function(){e(this).remove()})}function jt(t){return-1!==t.className.indexOf(v.annotation)}function Pt(t){jt(t.target)?kt(t.target,d):jt(t.target.parentNode)&&kt(t.target.parentNode,d)}function Tt(t){if(r.draggable){var n=e(this).attr("data-square");P(n)&&M.hasOwnProperty(n)&&(t=t.originalEvent,dt(n,M[n],t.changedTouches[0].pageX,t.changedTouches[0].pageY))}}function xt(t){r.sparePieces&&dt("spare",e(this).attr("data-piece"),t.pageX,t.pageY)}function St(t){r.sparePieces&&dt("spare",e(this).attr("data-piece"),(t=t.originalEvent).changedTouches[0].pageX,t.changedTouches[0].pageY)}m.clear=function(t){m.position({},t)},m.destroy=function(){s.html(""),u.remove(),s.unbind()},m.fen=function(){return m.position("fen")},m.flip=function(){return m.orientation("flip")},m.move=function(){if(0!==arguments.length){for(var t=!0,e={},n=0;n<arguments.length;n++)if(!1!==arguments[n])if(j(arguments[n])){var r=arguments[n].split("-");e[r[0]]=r[1]}else W(2826,"Invalid move passed to the move method.",arguments[n]);else t=!1;var o=function(t,e){var n=g(t);for(var r in e)if(e.hasOwnProperty(r)&&n.hasOwnProperty(r)){var o=n[r];delete n[r],n[e[r]]=o}return n}(M,e);return m.position(o,t),o}},m.orientation=function(t){return 0===arguments.length?T:"white"===t||"black"===t?(T=t,nt(),T):"flip"===t?(T="white"===T?"black":"white",nt(),T):void W(5482,"Invalid value passed to the orientation method.",t)},m.position=function(t,n){if(0===arguments.length)return g(M);if(w(t)&&"fen"===t.toLowerCase())return A(M);(w(t)&&"start"===t.toLowerCase()&&(t=g(a)),x(t)&&(t=O(t)),S(t))?(!1!==n&&(n=!0),n?(!function(t,n,o){if(0!==t.length)for(var i=0,s=0;s<t.length;s++){var a=t[s];"clear"===a.type?e("#"+U[a.square]+" ."+v.piece).fadeOut(r.trashSpeed,c):"add"!==a.type||r.sparePieces?"add"===a.type&&r.sparePieces?tt(a.piece,a.square,c):"move"===a.type&&Z(a.source,a.destination,a.piece,c):e("#"+U[a.square]).append(Y(a.piece,!0)).find("."+v.piece).fadeIn(r.appearSpeed,c)}function c(){(i+=1)===t.length&&(et(),E(r.onMoveEnd)&&r.onMoveEnd(g(n),g(o)))}}(function(t,e){t=g(t),e=g(e);var n=[],r={};for(var o in e)e.hasOwnProperty(o)&&t.hasOwnProperty(o)&&t[o]===e[o]&&(delete t[o],delete e[o]);for(o in e)if(e.hasOwnProperty(o)){var i=F(t,e[o],o);i&&(n.push({type:"move",source:i,destination:o,piece:e[o]}),delete t[i],delete e[o],r[o]=!0)}for(o in e)e.hasOwnProperty(o)&&(n.push({type:"add",square:o,piece:e[o]}),delete e[o]);for(o in t)t.hasOwnProperty(o)&&(r.hasOwnProperty(o)||(n.push({type:"clear",square:o,piece:t[o]}),delete t[o]));return n}(M,t),M,t),rt(t)):(rt(t),et())):W(6482,"Invalid value passed to the position method.",t)},m.resize=function(){H=function(){var t=parseInt(s.width(),10);if(!t||t<=0)return 0;for(var e=t-1;e%8!=0&&e>0;)e-=1;return e/8}(),c.css("width",8*H+"px"),u.css({height:H,width:H}),r.sparePieces&&s.find("."+v.sparePieces).css("paddingLeft",H+k+"px"),nt()},m.start=function(t){m.position("start",t)},m.setAddGhost=function(t){"boolean"==typeof t&&($=t)},m.removeGhosts=function(){c.find("."+v.ghost).each(function(t,e){kt(e,d)})},m.setShadeClassName=function(t){v.shade=t},m.annotate=function(t,n,r,o,i,s){if(P(t)){var a=e(function(t,e){var n='<div class="{annotation}';return C(e)?n+=" choice-border-"+e+'">':n+='">',n+=t?"<p>"+t+"</p>":"<p></p>",b(n+="</div>",v)}(n,r));if(a.hide().appendTo("#"+U[t]).fadeIn(h),C(i)&&setTimeout(kt,i,a,d),E(s)){var c=e(a.find("p")[0]);return s.call(c),c.promise()}return a.promise()}},m.removeAnnotations=function(){c.find("."+v.annotation).remove()},m.removeShadedSquares=function(){c.find("."+v.shade).each(function(t,e){kt(e,d)})},m.setOnDrop=function(t){r.onDrop=t},m.setOnDragStart=function(t){r.onDragStart=t},m.setOnSnapEnd=function(t){r.onSnapEnd=t},m.getRankedMoves=function(){return K},m.getNumMoveChoices=function(){return z},m.freezeRankings=function(){G=!1},m.allowReranking=function(){G=!0},m.clearMoveChoices=function(){K={},z=0};var Rt=_(function(t){B&&vt(t.pageX,t.pageY)},r.dragThrottleRate);var Ot=_(function(t){B&&(t.preventDefault(),vt(t.originalEvent.changedTouches[0].pageX,t.originalEvent.changedTouches[0].pageY))},r.dragThrottleRate);function At(t){var e=ot(t.pageX,t.pageY);B?wt(e):q&&bt(e)}function Ft(t){B&&wt(ot(t.originalEvent.changedTouches[0].pageX,t.originalEvent.changedTouches[0].pageY))}function It(t){if(!B&&E(r.onMouseoverSquare)){var n=e(t.currentTarget).attr("data-square");if(P(n)){var o=!1;M.hasOwnProperty(n)&&(o=M[n]),r.onMouseoverSquare(n,o,g(M),T)}}}function Mt(t){if(!B&&E(r.onMouseoutSquare)){var n=e(t.currentTarget).attr("data-square");if(P(n)){var o=!1;M.hasOwnProperty(n)&&(o=M[n]),r.onMouseoutSquare(n,o,g(M),T)}}}return T=r.orientation,r.hasOwnProperty("position")&&("start"===r.position?M=g(a):x(r.position)?M=O(r.position):S(r.position)?M=g(r.position):W(7263,"Invalid value passed to config.position.",r.position)),function(){var t,o;!function(){for(var t=0;t<n.length;t++)for(var e=1;e<=8;e++){var r=n[t]+e;U[r]=r+"-"+y()}var o="KQRNBP".split("");for(t=0;t<o.length;t++){var i="w"+o[t],s="b"+o[t];V[i]=i+"-"+y(),V[s]=s+"-"+y()}}(),s.html((t=r.sparePieces,o='<div class="{chessboard}">',t&&(o+='<div class="{sparePieces} {sparePiecesTop}"></div>'),o+='<div class="{board}"></div>',t&&(o+='<div class="{sparePieces} {sparePiecesBottom}"></div>'),b(o+="</div>",v))),c=s.find("."+v.board),r.sparePieces&&(l=s.find("."+v.sparePiecesTop),f=s.find("."+v.sparePiecesBottom));var i=y();e("body").append(Y("wP",!0,i)),u=e("#"+i),k=parseInt(c.css("borderLeftWidth"),10),m.resize()}(),function(){e("body").on("mousedown mousemove","."+v.piece,Et),c.on("mousedown","."+v.square,Ct),c.on("click",Pt),s.on("mousedown","."+v.sparePieces+" ."+v.piece,xt),c.on("mouseenter","."+v.square,It).on("mouseleave","."+v.square,Mt);var t=e(window);t.on("mousemove",Rt).on("mouseup",At),"ontouchstart"in document.documentElement&&(c.on("touchstart","."+v.square,Tt),s.on("touchstart","."+v.sparePieces+" ."+v.piece,St),t.on("touchmove",Ot).on("touchend",Ft))}(),m}v.alpha="alpha-d2270",v.black="black-3c85d",v.board="board-b72b1",v.chessboard="chessboard-63f37",v.clearfix="clearfix-7da63",v.highlight1="highlight1-32417",v.shade="shade1",v.annotation="annotation",v.highlight2="highlight2-9c5d2",v.notation="notation-322f9",v.numeric="numeric-fc462",v.piece="piece-417db",v.ghost="ghost-12abc",v.row="row-5277c",v.sparePieces="spare-pieces-7492f",v.sparePiecesBottom="spare-pieces-bottom-ae20f",v.sparePiecesTop="spare-pieces-top-4028b",v.square="square-55d63",v.shade="shade",v.white="white-1e1d7",console.assert("abc"===b("abc",{a:"x"})),console.assert("{a}bc"===b("{a}bc",{})),console.assert("{a}bc"===b("{a}bc",{p:"q"})),console.assert("xbc"===b("{a}bc",{a:"x"})),console.assert("xbcxbc"===b("{a}bc{a}bc",{a:"x"})),console.assert("xxy"===b("{a}{a}{b}",{a:"x",b:"y"})),console.assert(P("a1")),console.assert(P("e2")),console.assert(!P("D2")),console.assert(!P("g9")),console.assert(!P("a")),console.assert(!P(!0)),console.assert(!P(null)),console.assert(!P({})),console.assert(T("bP")),console.assert(T("bK")),console.assert(T("wK")),console.assert(T("wR")),console.assert(!T("WR")),console.assert(!T("Wr")),console.assert(!T("a")),console.assert(!T(!0)),console.assert(!T(null)),console.assert(!T({})),console.assert(x(s)),console.assert(x("8/8/8/8/8/8/8/8")),console.assert(x("r1bqkbnr/pppp1ppp/2n5/1B2p3/4P3/5N2/PPPP1PPP/RNBQK2R")),console.assert(x("3r3r/1p4pp/2nb1k2/pP3p2/8/PB2PN2/p4PPP/R4RK1 b - - 0 1")),console.assert(!x("3r3z/1p4pp/2nb1k2/pP3p2/8/PB2PN2/p4PPP/R4RK1 b - - 0 1")),console.assert(!x("anbqkbnr/8/8/8/8/8/PPPPPPPP/8")),console.assert(!x("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/")),console.assert(!x("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBN")),console.assert(!x("888888/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR")),console.assert(!x("888888/pppppppp/74/8/8/8/PPPPPPPP/RNBQKBNR")),console.assert(!x({})),console.assert(S(a)),console.assert(S({})),console.assert(S({e2:"wP"})),console.assert(S({e2:"wP",d2:"wP"})),console.assert(!S({e2:"BP"})),console.assert(!S({y2:"wP"})),console.assert(!S(null)),console.assert(!S("start")),console.assert(!S(s)),console.assert(A(a)===s),console.assert("8/8/8/8/8/8/8/8"===A({})),console.assert("8/8/8/8/8/8/Pp6/8"===A({a2:"wP",b2:"bP"})),t.exports=M,window.Chessboard=M,window.ChessBoard=window.Chessboard,window.Chessboard.fenToObj=O,window.Chessboard.objToFen=A}()},function(t,e,n){const r=n(10);t.exports=function(t){return r(t,{position:"start",draggable:!0})}},function(t,e,n){const r=n(5),o=n(4);var i=function(t,e){this.model=t,this.registerKeyListeners(),this.makeBoardDroppable(e)};i.prototype.registerKeyListeners=function(){var t=this;$(document).keydown(function(e){32===e.which&&t.submitThisRound()})},i.prototype.submitThisRound=function(){switch(this.model.getMode()){case r.RANK:this.model.submitForRankMode();break;case r.GUESS:console.log("guess");break;case r.NORMAL:console.log("normal");break;case r.AFTER_RANK:this.model.submitForAfterRankMode();break;default:throw new Error(o.INVALID_MODE)}},i.prototype.makeBoardDroppable=function(t){const e=this;$("#"+t).droppable({accept:function(t){const n=$(t[0]).attr("data");return console.log(n),e.model.canActivateReward(n)},drop:function(t,n){const r=n.draggable[0];e.model.useReward(r)}})},t.exports=i},function(t,e){t.exports={MOVETIME:300,EVAL_TIME:500}},function(t,e,n){(function(e){t.exports=function(n){if(t.exports.stub!==t.exports)return t.exports.stub.apply(this,arguments);try{return e.kill(n,0)}catch(t){return"EPERM"===t.code}},t.exports.stub=t.exports}).call(this,n(0))},function(t,e,n){var r=n(14),o=n(2).EOL,i=new RegExp(o);e.convertToMoveObject=function(t){if("object"==typeof t)return t;var e={};return e.from=t.substring(0,2),e.to=t.substring(2,4),t.length>4&&(e.promotion=t.substring(4)),e},e.convertToMoveString=function(t){return"string"==typeof t?t:t&&t.from&&t.to?t.from+t.to+(t.promotion?t.promotion:""):""},e.isProcessRunning=function(t){return r(t.pid)&&0!==t.stdout._readableState.length},e.getLines=function(t){var e=t.split(i);return t.lastIndexOf(o)<t.length-1?{lines:e,incompleteLine:e.pop()}:{lines:e}}},function(t,e,n){var r=n(6),o=n(2).EOL,s=(n(2),n(15)),a=function(t){this.enginePath=t};a.prototype.createWorker=function(){this.engine=new Worker(this.enginePath)},a.prototype.isReadyCommand=function(){var t=this,e=r.defer(),n=function(r){"readyok"===r.data&&(t.printListener&&(console.log("***********************"),t.engine.removeEventListener("message",t.printListener,!1)),t.engine.removeEventListener("message",n,!1),e.resolve())};return this.engine.addEventListener("message",n,!1),this.engine.postMessage("isready"+o),e.promise},a.prototype.setOptionCommand=function(t,e){var n="setoption name "+t+(e?" value "+e:"")+o;return this.engine.postMessage(n),this.isReadyCommand()},a.prototype.uciNewGameCommand=function(){return this.engine.postMessage("ucinewgame"+o),this.isReadyCommand()},a.prototype.positionCommand=function(t,e){var n="position ";return n+="startpos"===t?"startpos":"fen "+t,e&&(n+=" moves "+e),n+=o,this.engine.postMessage(n),this.isReadyCommand()},a.prototype.printCommand=function(t){var e=function(e){const n=e.data;"function"==typeof t&&t(n)};return this.printListener=e,this.engine.addEventListener("message",e,!1),this.engine.postMessage("d"+o),this.isReadyCommand()},a.prototype.timeLimitedGoCommand=function(t,e,n){var a=this,c=r.defer(),u=function(e){var n=e.data;if(n.startsWith("info")&&t)t(n);else if(n.startsWith("bestmove")){a.engine.removeEventListener("message",u,!1);var r=/bestmove (\w+)(.*)?/g.exec(n);if(!r)throw new Error('Invalid format of bestmove. Expected "bestmove <move>". Returned "'+lines[i]+'"');c.resolve(s.convertToMoveObject(r[1]))}};this.engine.addEventListener("message",u,!1);var l="go wtime "+e+" btime "+n;return this.engine.postMessage(l+o),c.promise},a.prototype.stopCommand=function(){var t=this,e=r.defer(),n=function(r){var o=r.data;if(o.startsWith("bestmove")){t.goInfiniteListener&&t.engine.removeEventListener("message",t.goInfiniteListener,!1),t.engine.removeEventListener("message",n,!1);var a=/bestmove (\w+)(.*)?/g.exec(o);if(!a)throw new Error('Invalid format of bestmove. Expected "bestmove <move>". Returned "'+lines[i]+'"');e.resolve(s.convertToMoveObject(a[1]))}};return this.engine.addEventListener("message",n,!1),this.engine.postMessage("stop"+o),e.promise},a.prototype.goCommand=function(t,e){var n=function(t){var n=t.data;n.startsWith("info")&&e&&e(n)},r="go";if(null===t)r+=o;else{for(var i in t)if(t.hasOwnProperty(i)){r+=" "+i;var s=t[i];null!==s&&""!==s&&(r+=" "+s)}r+=o}return this.goInfiniteListener=n,this.engine.addEventListener("message",n,!1),this.engine.postMessage(r),this.isReadyCommand()},t.exports=a},function(t,e,n){var r,o=function(t){var e="b",n="w",r=-1,o="p",i="n",s="b",a="r",c="q",u="k",l="pnbrqkPNBRQK",f="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",p=["1-0","0-1","1/2-1/2","*"],h={b:[16,32,17,15],w:[-16,-32,-17,-15]},d={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},v=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],_=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],y={p:0,n:1,b:2,r:3,q:4,k:5},g={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},m={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},b=7,w=6,E=1,C=0,k={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},j={w:[{square:k.a1,flag:m.QSIDE_CASTLE},{square:k.h1,flag:m.KSIDE_CASTLE}],b:[{square:k.a8,flag:m.QSIDE_CASTLE},{square:k.h8,flag:m.KSIDE_CASTLE}]},P=new Array(128),T={w:r,b:r},x=n,S={w:0,b:0},R=r,O=0,A=1,F=[],I={};function M(){P=new Array(128),T={w:r,b:r},x=n,S={w:0,b:0},R=r,O=0,A=1,F=[],I={},V(B())}function N(){D(f)}function D(t){var o=t.split(/\s+/),i=o[0],s=0;if(!L(t).valid)return!1;M();for(var a=0;a<i.length;a++){var c=i.charAt(a);if("/"===c)s+=8;else if(-1!=="0123456789".indexOf(c))s+=parseInt(c,10);else{var u=c<"a"?n:e;Q({type:c.toLowerCase(),color:u},st(s)),s++}}return x=o[1],o[2].indexOf("K")>-1&&(S.w|=m.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(S.w|=m.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(S.b|=m.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(S.b|=m.QSIDE_CASTLE),R="-"===o[3]?r:k[o[3]],O=parseInt(o[4],10),A=parseInt(o[5],10),V(B()),!0}function L(t){var e="No errors.",n="FEN string must contain six space-delimited fields.",r="6th field (move number) must be a positive integer.",o="5th field (half move counter) must be a non-negative integer.",i="4th field (en-passant square) is invalid.",s="3rd field (castling availability) is invalid.",a="2nd field (side to move) is invalid.",c="1st field (piece positions) does not contain 8 '/'-delimited rows.",u="1st field (piece positions) is invalid [consecutive numbers].",l="1st field (piece positions) is invalid [invalid piece].",f="1st field (piece positions) is invalid [row too large].",p="Illegal en-passant square",h=t.split(/\s+/);if(6!==h.length)return{valid:!1,error_number:1,error:n};if(isNaN(h[5])||parseInt(h[5],10)<=0)return{valid:!1,error_number:2,error:r};if(isNaN(h[4])||parseInt(h[4],10)<0)return{valid:!1,error_number:3,error:o};if(!/^(-|[abcdefgh][36])$/.test(h[3]))return{valid:!1,error_number:4,error:i};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(h[2]))return{valid:!1,error_number:5,error:s};if(!/^(w|b)$/.test(h[1]))return{valid:!1,error_number:6,error:a};var d=h[0].split("/");if(8!==d.length)return{valid:!1,error_number:7,error:c};for(var v=0;v<d.length;v++){for(var _=0,y=!1,g=0;g<d[v].length;g++)if(isNaN(d[v][g])){if(!/^[prnbqkPRNBQK]$/.test(d[v][g]))return{valid:!1,error_number:9,error:l};_+=1,y=!1}else{if(y)return{valid:!1,error_number:8,error:u};_+=parseInt(d[v][g],10),y=!0}if(8!==_)return{valid:!1,error_number:10,error:f}}return"3"==h[3][1]&&"w"==h[1]||"6"==h[3][1]&&"b"==h[1]?{valid:!1,error_number:11,error:p}:{valid:!0,error_number:0,error:e}}function B(){for(var t=0,o="",i=k.a8;i<=k.h1;i++){if(null==P[i])t++;else{t>0&&(o+=t,t=0);var s=P[i].color,a=P[i].type;o+=s===n?a.toUpperCase():a.toLowerCase()}i+1&136&&(t>0&&(o+=t),i!==k.h1&&(o+="/"),t=0,i+=8)}var c="";S[n]&m.KSIDE_CASTLE&&(c+="K"),S[n]&m.QSIDE_CASTLE&&(c+="Q"),S[e]&m.KSIDE_CASTLE&&(c+="k"),S[e]&m.QSIDE_CASTLE&&(c+="q"),c=c||"-";var u=R===r?"-":st(R);return[o,x,c,u,O,A].join(" ")}function q(t){for(var e=0;e<t.length;e+=2)"string"==typeof t[e]&&"string"==typeof t[e+1]&&(I[t[e]]=t[e+1]);return I}function V(t){F.length>0||(t!==f?(I.SetUp="1",I.FEN=t):(delete I.SetUp,delete I.FEN))}function U(t){var e=P[k[t]];return e?{type:e.type,color:e.color}:null}function Q(t,e){if(!("type"in t&&"color"in t))return!1;if(-1===l.indexOf(t.type.toLowerCase()))return!1;if(!(e in k))return!1;var n=k[e];return(t.type!=u||T[t.color]==r||T[t.color]==n)&&(P[n]={type:t.type,color:t.color},t.type===u&&(T[t.color]=n),V(B()),!0)}function H(t,e,n,r,i){var s={color:x,from:e,to:n,flags:r,piece:t[e].type};return i&&(s.flags|=m.PROMOTION,s.promotion=i),t[n]?s.captured=t[n].type:r&m.EP_CAPTURE&&(s.captured=o),s}function $(t){function e(t,e,n,r,u){if(t[n].type!==o||ot(r)!==C&&ot(r)!==b)e.push(H(t,n,r,u));else for(var l=[c,a,s,i],f=0,p=l.length;f<p;f++)e.push(H(t,n,r,u,l[f]))}var n=[],r=x,u=at(r),l={b:E,w:w},f=k.a8,p=k.h1,v=!1,_=!(void 0!==t&&"legal"in t)||t.legal;if(void 0!==t&&"square"in t){if(!(t.square in k))return[];f=p=k[t.square],v=!0}for(var y=f;y<=p;y++)if(136&y)y+=7;else{var g=P[y];if(null!=g&&g.color===r)if(g.type===o){var j=y+h[r][0];if(null==P[j]){e(P,n,y,j,m.NORMAL);j=y+h[r][1];l[r]===ot(y)&&null==P[j]&&e(P,n,y,j,m.BIG_PAWN)}for(O=2;O<4;O++){136&(j=y+h[r][O])||(null!=P[j]&&P[j].color===u?e(P,n,y,j,m.CAPTURE):j===R&&e(P,n,y,R,m.EP_CAPTURE))}}else for(var O=0,A=d[g.type].length;O<A;O++){var F=d[g.type][O];for(j=y;!(136&(j+=F));){if(null!=P[j]){if(P[j].color===r)break;e(P,n,y,j,m.CAPTURE);break}if(e(P,n,y,j,m.NORMAL),"n"===g.type||"k"===g.type)break}}}if(!v||p===T[r]){if(S[r]&m.KSIDE_CASTLE){var I=(M=T[r])+2;null!=P[M+1]||null!=P[I]||G(u,T[r])||G(u,M+1)||G(u,I)||e(P,n,T[r],I,m.KSIDE_CASTLE)}if(S[r]&m.QSIDE_CASTLE){var M;I=(M=T[r])-2;null!=P[M-1]||null!=P[M-2]||null!=P[M-3]||G(u,T[r])||G(u,M-1)||G(u,I)||e(P,n,T[r],I,m.QSIDE_CASTLE)}}if(!_)return n;var N=[];for(y=0,A=n.length;y<A;y++)et(n[y]),W(r)||N.push(n[y]),nt();return N}function K(t,e){var n="";if(t.flags&m.KSIDE_CASTLE)n="O-O";else if(t.flags&m.QSIDE_CASTLE)n="O-O-O";else{var r=function(t,e){for(var n=$({legal:!e}),r=t.from,o=t.to,i=t.piece,s=0,a=0,c=0,u=0,l=n.length;u<l;u++){var f=n[u].from,p=n[u].to,h=n[u].piece;i===h&&r!==f&&o===p&&(s++,ot(r)===ot(f)&&a++,it(r)===it(f)&&c++)}if(s>0)return a>0&&c>0?st(r):c>0?st(r).charAt(1):st(r).charAt(0);return""}(t,e);t.piece!==o&&(n+=t.piece.toUpperCase()+r),t.flags&(m.CAPTURE|m.EP_CAPTURE)&&(t.piece===o&&(n+=st(t.from)[0]),n+="x"),n+=st(t.to),t.flags&m.PROMOTION&&(n+="="+t.promotion.toUpperCase())}return et(t),X()&&(Y()?n+="#":n+="+"),nt(),n}function z(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function G(t,r){for(var i=k.a8;i<=k.h1;i++)if(136&i)i+=7;else if(null!=P[i]&&P[i].color===t){var s=P[i],a=i-r,c=a+119;if(v[c]&1<<y[s.type]){if(s.type===o){if(a>0){if(s.color===n)return!0}else if(s.color===e)return!0;continue}if("n"===s.type||"k"===s.type)return!0;for(var u=_[c],l=i+u,f=!1;l!==r;){if(null!=P[l]){f=!0;break}l+=u}if(!f)return!0}}return!1}function W(t){return G(at(t),T[t])}function X(){return W(x)}function Y(){return X()&&0===$().length}function J(){return!X()&&0===$().length}function Z(){for(var t={},e=[],n=0,r=0,o=k.a8;o<=k.h1;o++)if(r=(r+1)%2,136&o)o+=7;else{var a=P[o];a&&(t[a.type]=a.type in t?t[a.type]+1:1,a.type===s&&e.push(r),n++)}if(2===n)return!0;if(3===n&&(1===t[s]||1===t[i]))return!0;if(n===t[s]+2){var c=0,u=e.length;for(o=0;o<u;o++)c+=e[o];if(0===c||c===u)return!0}return!1}function tt(){for(var t=[],e={},n=!1;;){var r=nt();if(!r)break;t.push(r)}for(;;){var o=B().split(" ").slice(0,4).join(" ");if(e[o]=o in e?e[o]+1:1,e[o]>=3&&(n=!0),!t.length)break;et(t.pop())}return n}function et(t){var n=x,i=at(n);if(function(t){F.push({move:t,kings:{b:T.b,w:T.w},turn:x,castling:{b:S.b,w:S.w},ep_square:R,half_moves:O,move_number:A})}(t),P[t.to]=P[t.from],P[t.from]=null,t.flags&m.EP_CAPTURE&&(x===e?P[t.to-16]=null:P[t.to+16]=null),t.flags&m.PROMOTION&&(P[t.to]={type:t.promotion,color:n}),P[t.to].type===u){if(T[P[t.to].color]=t.to,t.flags&m.KSIDE_CASTLE){var s=t.to-1,a=t.to+1;P[s]=P[a],P[a]=null}else if(t.flags&m.QSIDE_CASTLE){s=t.to+1,a=t.to-2;P[s]=P[a],P[a]=null}S[n]=""}if(S[n])for(var c=0,l=j[n].length;c<l;c++)if(t.from===j[n][c].square&&S[n]&j[n][c].flag){S[n]^=j[n][c].flag;break}if(S[i])for(c=0,l=j[i].length;c<l;c++)if(t.to===j[i][c].square&&S[i]&j[i][c].flag){S[i]^=j[i][c].flag;break}R=t.flags&m.BIG_PAWN?"b"===x?t.to-16:t.to+16:r,t.piece===o?O=0:t.flags&(m.CAPTURE|m.EP_CAPTURE)?O=0:O++,x===e&&A++,x=at(x)}function nt(){var t=F.pop();if(null==t)return null;var n=t.move;T=t.kings,x=t.turn,S=t.castling,R=t.ep_square,O=t.half_moves,A=t.move_number;var r,i,s=x,a=at(x);if(P[n.from]=P[n.to],P[n.from].type=n.piece,P[n.to]=null,n.flags&m.CAPTURE)P[n.to]={type:n.captured,color:a};else if(n.flags&m.EP_CAPTURE){var c;c=s===e?n.to-16:n.to+16,P[c]={type:o,color:a}}n.flags&(m.KSIDE_CASTLE|m.QSIDE_CASTLE)&&(n.flags&m.KSIDE_CASTLE?(r=n.to+1,i=n.to-1):n.flags&m.QSIDE_CASTLE&&(r=n.to-2,i=n.to+1),P[r]=P[i],P[i]=null);return n}function rt(t,e){var n=z(t);if(e){var r=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(r)var o=r[1],i=r[2],s=r[3],a=r[4]}for(var c=$(),u=0,l=c.length;u<l;u++){if(n===z(K(c[u]))||e&&n===z(K(c[u],!0)))return c[u];if(r&&(!o||o.toLowerCase()==c[u].piece)&&k[i]==c[u].from&&k[s]==c[u].to&&(!a||a.toLowerCase()==c[u].promotion))return c[u]}return null}function ot(t){return t>>4}function it(t){return 15&t}function st(t){var e=it(t),n=ot(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(n,n+1)}function at(t){return t===n?e:n}function ct(t){var e=function t(e){var n=e instanceof Array?[]:{};for(var r in e)n[r]="object"==typeof r?t(e[r]):e[r];return n}(t);e.san=K(e,!1),e.to=st(e.to),e.from=st(e.from);var n="";for(var r in m)m[r]&e.flags&&(n+=g[r]);return e.flags=n,e}function ut(t){return t.replace(/^\s+|\s+$/g,"")}return D(void 0===t?f:t),{WHITE:n,BLACK:e,PAWN:o,KNIGHT:i,BISHOP:s,ROOK:a,QUEEN:c,KING:u,SQUARES:function(){for(var t=[],e=k.a8;e<=k.h1;e++)136&e?e+=7:t.push(st(e));return t}(),FLAGS:g,load:function(t){return D(t)},reset:function(){return N()},moves:function(t){for(var e=$(t),n=[],r=0,o=e.length;r<o;r++)void 0!==t&&"verbose"in t&&t.verbose?n.push(ct(e[r])):n.push(K(e[r],!1));return n},in_check:function(){return X()},in_checkmate:function(){return Y()},in_stalemate:function(){return J()},in_draw:function(){return O>=100||J()||Z()||tt()},insufficient_material:function(){return Z()},in_threefold_repetition:function(){return tt()},game_over:function(){return O>=100||Y()||J()||Z()||tt()},validate_fen:function(t){return L(t)},fen:function(){return B()},pgn:function(t){var e="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\n",n="object"==typeof t&&"number"==typeof t.max_width?t.max_width:0,r=[],o=!1;for(var i in I)r.push("["+i+' "'+I[i]+'"]'+e),o=!0;o&&F.length&&r.push(e);for(var s=[];F.length>0;)s.push(nt());for(var a=[],c="";s.length>0;){var u=s.pop();F.length||"b"!==u.color?"w"===u.color&&(c.length&&a.push(c),c=A+"."):c=A+". ...",c=c+" "+K(u,!1),et(u)}if(c.length&&a.push(c),void 0!==I.Result&&a.push(I.Result),0===n)return r.join("")+a.join(" ");var l=0;for(i=0;i<a.length;i++)l+a[i].length>n&&0!==i?(" "===r[r.length-1]&&r.pop(),r.push(e),l=0):0!==i&&(r.push(" "),l++),r.push(a[i]),l+=a[i].length;return r.join("")},load_pgn:function(t,e){var n=void 0!==e&&"sloppy"in e&&e.sloppy;function r(t){return t.replace(/\\/g,"\\")}var o="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",i=new RegExp("^(\\[(.|"+r(o)+")*\\])("+r(o)+")*1.("+r(o)+"|.)*$","g"),s=t.replace(i,"$1");"["!==s[0]&&(s=""),N();var a=function(t,e){for(var n="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",o={},i=t.split(new RegExp(r(n))),s="",a="",c=0;c<i.length;c++)s=i[c].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),a=i[c].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),ut(s).length>0&&(o[s]=a);return o}(s,e);for(var c in a)q([c,a[c]]);if("1"===a.SetUp&&!("FEN"in a&&D(a.FEN)))return!1;var u=t.replace(s,"").replace(new RegExp(r(o),"g")," ");u=u.replace(/(\{[^}]+\})+?/g,"");for(var l=/(\([^\(\)]+\))+?/g;l.test(u);)u=u.replace(l,"");var f=ut(u=(u=(u=u.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));f=f.join(",").replace(/,,+/g,",").split(",");for(var h="",d=0;d<f.length-1;d++){if(null==(h=rt(f[d],n)))return!1;et(h)}if(h=f[f.length-1],p.indexOf(h)>-1)(function(t){for(var e in t)return!0;return!1})(I)&&void 0===I.Result&&q(["Result",h]);else{if(null==(h=rt(h,n)))return!1;et(h)}return!0},header:function(){return q(arguments)},ascii:function(){return function(){for(var t="   +------------------------+\n",e=k.a8;e<=k.h1;e++){if(0===it(e)&&(t+=" "+"87654321"[ot(e)]+" |"),null==P[e])t+=" . ";else{var r=P[e].type;t+=" "+(P[e].color===n?r.toUpperCase():r.toLowerCase())+" "}e+1&136&&(t+="|\n",e+=8)}return t+="   +------------------------+\n",t+="     a  b  c  d  e  f  g  h\n"}()},turn:function(){return x},move:function(t,e){var n=void 0!==e&&"sloppy"in e&&e.sloppy,r=null;if("string"==typeof t)r=rt(t,n);else if("object"==typeof t)for(var o=$(),i=0,s=o.length;i<s;i++)if(!(t.from!==st(o[i].from)||t.to!==st(o[i].to)||"promotion"in o[i]&&t.promotion!==o[i].promotion)){r=o[i];break}if(!r)return null;var a=ct(r);return et(r),a},undo:function(){var t=nt();return t?ct(t):null},clear:function(){return M()},put:function(t,e){return Q(t,e)},get:function(t){return U(t)},remove:function(t){return function(t){var e=U(t);return P[k[t]]=null,e&&e.type===u&&(T[e.color]=r),V(B()),e}(t)},perft:function(t){return function t(e){for(var n=$({legal:!1}),r=0,o=x,i=0,s=n.length;i<s;i++)et(n[i]),W(o)||(e-1>0?r+=t(e-1):r++),nt();return r}(t)},square_color:function(t){if(t in k){var e=k[t];return(ot(e)+it(e))%2==0?"light":"dark"}return null},history:function(t){for(var e=[],n=[],r=(void 0!==t&&"verbose"in t&&t.verbose);F.length>0;)e.push(nt());for(;e.length>0;){var o=e.pop();r?n.push(ct(o)):n.push(K(o)),et(o)}return n}}};
/* @license
 * Copyright (c) 2016, Jeff Hlywa (jhlywa@gmail.com)
 * Released under the BSD license
 * https://github.com/jhlywa/chess.js/blob/master/LICENSE
 */e.Chess=o,void 0===(r=function(){return o}.call(e,n,e,t))||(t.exports=r)},function(t,e,n){n(6);const r=n(17),o=n(3),i=(n(2).EOL,n(16)),s=n(8),a=n(13);var c=function(){this.game=r(),this.engine=new i("js/stockfish.js"),this.engine.createWorker()};c.prototype.setStockfishLevel=function(t){return console.log(t),o(s.isInteger(t)&&t>=1&&t<=20),this.engine.setOptionCommand("Skill Level",t)},c.prototype.getPosition=function(){return this.game.fen()},c.prototype.updatePosition=function(t){const e=this.game.move(t);o(null!==e)},c.prototype.isLegalMove=function(t){const e=null!==this.game.move(t);return e&&this.game.undo(),e},c.prototype.move=function(t){o(!0===this.isLegalMove(t)),this.game.move(t)},c.prototype.evaluateMove=function(t){var e="";const n=t.from+t.to,r=this;return this.engine.isReadyCommand().then(function(){return r.engine.positionCommand(r.getPosition())}).then(function(){return r.engine.goCommand({movetime:a.EVAL_TIME,searchmoves:n},function(t){e=t})}).then(function(){return r.engine.stopCommand()}).then(function(){const n=s.parseCentipawnEvaluation(e);return t.score=parseInt(n),t}).catch(function(t){console.log(t.message)})},c.prototype.getNextBestMove=function(t){o(this.getPosition()===t),this.game.load(t);const e=this;return this.engine.isReadyCommand().then(function(){return e.engine.positionCommand(t)}).then(function(){return e.engine.goCommand({movetime:a.MOVETIME})}).then(function(){return e.engine.stopCommand()})},t.exports=c},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,o,i,s,a,c=1,u={},l=!1,f=t.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(t);p=p&&p.setTimeout?p:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick(function(){d(t)})}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((i=new MessageChannel).port1.onmessage=function(t){d(t.data)},r=function(t){i.port2.postMessage(t)}):f&&"onreadystatechange"in f.createElement("script")?(o=f.documentElement,r=function(t){var e=f.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,o.removeChild(e),e=null},o.appendChild(e)}):r=function(t){setTimeout(d,0,t)}:(s="setImmediate$"+Math.random()+"$",a=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(s)&&d(+e.data.slice(s.length))},t.addEventListener?t.addEventListener("message",a,!1):t.attachEvent("onmessage",a),r=function(e){t.postMessage(s+e,"*")}),p.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var o={callback:t,args:e};return u[c]=o,r(c),c++},p.clearImmediate=h}function h(t){delete u[t]}function d(t){if(l)setTimeout(d,0,t);else{var e=u[t];if(e){l=!0;try{!function(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(n,r)}}(e)}finally{h(t),l=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(1),n(0))},function(t,e,n){(function(e,n,r){t.exports=function(){var t,o,i;return function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof _dereq_&&_dereq_;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return o(n||t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof _dereq_&&_dereq_,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){"use strict";e.exports=function(t){var e=t._SomePromiseArray;function n(t){var n=new e(t),r=n.promise();return n.setHowMany(1),n.setUnwrap(),n.init(),r}t.any=function(t){return n(t)},t.prototype.any=function(){return n(this)}}},{}],2:[function(t,n,r){"use strict";var o;try{throw new Error}catch(t){o=t}var i=t("./schedule"),s=t("./queue"),a=t("./util");function c(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new s(16),this._normalQueue=new s(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=i}function u(t,e,n){this._lateQueue.push(t,e,n),this._queueTick()}function l(t,e,n){this._normalQueue.push(t,e,n),this._queueTick()}function f(t){this._normalQueue._pushOne(t),this._queueTick()}c.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,e},c.prototype.hasCustomScheduler=function(){return this._customScheduler},c.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},c.prototype.disableTrampolineIfNecessary=function(){a.hasDevTools&&(this._trampolineEnabled=!1)},c.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},c.prototype.fatalError=function(t,n){n?(e.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),e.exit(2)):this.throwLater(t)},c.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},a.hasDevTools?(c.prototype.invokeLater=function(t,e,n){this._trampolineEnabled?u.call(this,t,e,n):this._schedule(function(){setTimeout(function(){t.call(e,n)},100)})},c.prototype.invoke=function(t,e,n){this._trampolineEnabled?l.call(this,t,e,n):this._schedule(function(){t.call(e,n)})},c.prototype.settlePromises=function(t){this._trampolineEnabled?f.call(this,t):this._schedule(function(){t._settlePromises()})}):(c.prototype.invokeLater=u,c.prototype.invoke=l,c.prototype.settlePromises=f),c.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var n=t.shift(),r=t.shift();e.call(n,r)}else e._settlePromises()}},c.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},c.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},c.prototype._reset=function(){this._isTickUsed=!1},n.exports=c,n.exports.firstLineError=o},{"./queue":26,"./schedule":29,"./util":36}],3:[function(t,e,n){"use strict";e.exports=function(t,e,n,r){var o=!1,i=function(t,e){this._reject(e)},s=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(i,i,null,this,t)},a=function(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)},c=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(i){o||(o=!0,t.prototype._propagateFrom=r.propagateFromFunction(),t.prototype._boundValue=r.boundValueFunction());var u=n(i),l=new t(e);l._propagateFrom(this,1);var f=this._target();if(l._setBoundTo(u),u instanceof t){var p={promiseRejectionQueued:!1,promise:l,target:f,bindingPromise:u};f._then(e,s,void 0,l,p),u._then(a,c,void 0,l,p),l._setOnCancel(u)}else l._resolveCallback(f);return l},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},t.bind=function(e,n){return t.resolve(n).bind(e)}}},{}],4:[function(t,e,n){"use strict";var r;"undefined"!=typeof Promise&&(r=Promise);var o=t("./promise")();o.noConflict=function(){try{Promise===o&&(Promise=r)}catch(t){}return o},e.exports=o},{"./promise":22}],5:[function(t,e,n){"use strict";var r=Object.create;if(r){var o=r(null),i=r(null);o[" size"]=i[" size"]=0}e.exports=function(e){var n=t("./util"),r=n.canEvaluate;function o(t){var r=this.pop(),o=function(t,r){var o;if(null!=t&&(o=t[r]),"function"!=typeof o){var i="Object "+n.classString(t)+" has no method '"+n.toString(r)+"'";throw new e.TypeError(i)}return o}(t,r);return o.apply(t,this)}function i(t){return t[this]}function s(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}n.isIdentifier,e.prototype.call=function(t){var e=[].slice.call(arguments,1);return e.push(t),this._then(o,void 0,void 0,e,void 0)},e.prototype.get=function(t){var e,n="number"==typeof t;if(n)e=s;else if(r){var o=(void 0)(t);e=null!==o?o:i}else e=i;return this._then(e,void 0,void 0,t,void 0)}}},{"./util":36}],6:[function(t,e,n){"use strict";e.exports=function(e,n,r,o){var i=t("./util"),s=i.tryCatch,a=i.errorObj,c=e._async;e.prototype.break=e.prototype.cancel=function(){if(!o.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t._isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var n=t._cancellationParent;if(null==n||!n._isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),t._setWillBeCancelled(),e=t,t=n}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),c.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(t,e){if(i.isArray(t))for(var n=0;n<t.length;++n)this._doInvokeOnCancel(t[n],e);else if(void 0!==t)if("function"==typeof t){if(!e){var r=s(t).call(this._boundValue());r===a&&(this._attachExtraTrace(r.e),c.throwLater(r.e))}}else t._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),c.invoke(this._doInvokeOnCancel,this,t)},e.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(t,e,n){"use strict";e.exports=function(e){var n=t("./util"),r=t("./es5").keys,o=n.tryCatch,i=n.errorObj;return function(t,s,a){return function(c){var u=a._boundValue();t:for(var l=0;l<t.length;++l){var f=t[l];if(f===Error||null!=f&&f.prototype instanceof Error){if(c instanceof f)return o(s).call(u,c)}else if("function"==typeof f){var p=o(f).call(u,c);if(p===i)return p;if(p)return o(s).call(u,c)}else if(n.isObject(c)){for(var h=r(f),d=0;d<h.length;++d){var v=h[d];if(f[v]!=c[v])continue t}return o(s).call(u,c)}}return e}}}},{"./es5":13,"./util":36}],8:[function(t,e,n){"use strict";e.exports=function(t){var e=!1,n=[];function r(){this._trace=new r.CapturedTrace(o())}function o(){var t=n.length-1;if(t>=0)return n[t]}return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},r.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,n.push(this._trace))},r.prototype._popContext=function(){if(void 0!==this._trace){var t=n.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},r.CapturedTrace=null,r.create=function(){if(e)return new r},r.deactivateLongStackTraces=function(){},r.activateLongStackTraces=function(){var n=t.prototype._pushContext,i=t.prototype._popContext,s=t._peekContext,a=t.prototype._peekContext,c=t.prototype._promiseCreated;r.deactivateLongStackTraces=function(){t.prototype._pushContext=n,t.prototype._popContext=i,t._peekContext=s,t.prototype._peekContext=a,t.prototype._promiseCreated=c,e=!1},e=!0,t.prototype._pushContext=r.prototype._pushContext,t.prototype._popContext=r.prototype._popContext,t._peekContext=t.prototype._peekContext=o,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},r}},{}],9:[function(t,n,r){"use strict";n.exports=function(n,r){var o,i,s,a=n._getDomain,c=n._async,u=t("./errors").Warning,l=t("./util"),f=l.canAttachTrace,p=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,h=/\((?:timers\.js):\d+:\d+\)/,d=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,v=null,_=null,y=!1,g=!(0==l.env("BLUEBIRD_DEBUG")),m=!(0==l.env("BLUEBIRD_WARNINGS")||!g&&!l.env("BLUEBIRD_WARNINGS")),b=!(0==l.env("BLUEBIRD_LONG_STACK_TRACES")||!g&&!l.env("BLUEBIRD_LONG_STACK_TRACES")),w=0!=l.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(m||!!l.env("BLUEBIRD_W_FORGOTTEN_RETURN"));n.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},n.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var t=this;setTimeout(function(){t._notifyUnhandledRejection()},1)}},n.prototype._notifyUnhandledRejectionIsHandled=function(){Q("rejectionHandled",o,void 0,this)},n.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},n.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},n.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),Q("unhandledRejection",i,t,this)}},n.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},n.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},n.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},n.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},n.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},n.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},n.prototype._warn=function(t,e,n){return B(t,e,n||this)},n.onPossiblyUnhandledRejection=function(t){var e=a();i="function"==typeof t?null===e?t:l.domainBind(e,t):void 0},n.onUnhandledRejectionHandled=function(t){var e=a();o="function"==typeof t?null===e?t:l.domainBind(e,t):void 0};var E=function(){};n.longStackTraces=function(){if(c.haveItemsQueued()&&!Y.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!Y.longStackTraces&&$()){var t=n.prototype._captureStackTrace,e=n.prototype._attachExtraTrace;Y.longStackTraces=!0,E=function(){if(c.haveItemsQueued()&&!Y.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");n.prototype._captureStackTrace=t,n.prototype._attachExtraTrace=e,r.deactivateLongStackTraces(),c.enableTrampoline(),Y.longStackTraces=!1},n.prototype._captureStackTrace=D,n.prototype._attachExtraTrace=L,r.activateLongStackTraces(),c.disableTrampolineIfNecessary()}},n.hasLongStackTraces=function(){return Y.longStackTraces&&$()};var C=function(){try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return l.global.dispatchEvent(t),function(t,e){var n=new CustomEvent(t.toLowerCase(),{detail:e,cancelable:!0});return!l.global.dispatchEvent(n)}}if("function"==typeof Event){var t=new Event("CustomEvent");return l.global.dispatchEvent(t),function(t,e){var n=new Event(t.toLowerCase(),{cancelable:!0});return n.detail=e,!l.global.dispatchEvent(n)}}var t=document.createEvent("CustomEvent");return t.initCustomEvent("testingtheevent",!1,!0,{}),l.global.dispatchEvent(t),function(t,e){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t.toLowerCase(),!1,!0,e),!l.global.dispatchEvent(n)}}catch(t){}return function(){return!1}}(),k=l.isNode?function(){return e.emit.apply(e,arguments)}:l.global?function(t){var e="on"+t.toLowerCase(),n=l.global[e];return!!n&&(n.apply(l.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function j(t,e){return{promise:e}}var P={promiseCreated:j,promiseFulfilled:j,promiseRejected:j,promiseResolved:j,promiseCancelled:j,promiseChained:function(t,e,n){return{promise:e,child:n}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,n){return{reason:e,promise:n}},rejectionHandled:j},T=function(t){var e=!1;try{e=k.apply(null,arguments)}catch(t){c.throwLater(t),e=!0}var n=!1;try{n=C(t,P[t].apply(null,arguments))}catch(t){c.throwLater(t),n=!0}return n||e};function x(){return!1}function S(t,e,n){var r=this;try{t(e,n,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+l.toString(t));r._attachCancellationCallback(t)})}catch(t){return t}}function R(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?l.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function O(){return this._onCancelField}function A(t){this._onCancelField=t}function F(){this._cancellationParent=void 0,this._onCancelField=void 0}function I(t,e){if(0!=(1&e)){this._cancellationParent=t;var n=t._branchesRemainingToCancel;void 0===n&&(n=0),t._branchesRemainingToCancel=n+1}0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}n.config=function(t){if("longStackTraces"in(t=Object(t))&&(t.longStackTraces?n.longStackTraces():!t.longStackTraces&&n.hasLongStackTraces()&&E()),"warnings"in t){var e=t.warnings;Y.warnings=!!e,w=Y.warnings,l.isObject(e)&&"wForgottenReturn"in e&&(w=!!e.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!Y.cancellation){if(c.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");n.prototype._clearCancellationData=F,n.prototype._propagateFrom=I,n.prototype._onCancel=O,n.prototype._setOnCancel=A,n.prototype._attachCancellationCallback=R,n.prototype._execute=S,M=I,Y.cancellation=!0}return"monitoring"in t&&(t.monitoring&&!Y.monitoring?(Y.monitoring=!0,n.prototype._fireEvent=T):!t.monitoring&&Y.monitoring&&(Y.monitoring=!1,n.prototype._fireEvent=x)),n},n.prototype._fireEvent=x,n.prototype._execute=function(t,e,n){try{t(e,n)}catch(t){return t}},n.prototype._onCancel=function(){},n.prototype._setOnCancel=function(t){},n.prototype._attachCancellationCallback=function(t){},n.prototype._captureStackTrace=function(){},n.prototype._attachExtraTrace=function(){},n.prototype._clearCancellationData=function(){},n.prototype._propagateFrom=function(t,e){};var M=function(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)};function N(){var t=this._boundTo;return void 0!==t&&t instanceof n?t.isFulfilled()?t.value():void 0:t}function D(){this._trace=new W(this._peekContext())}function L(t,e){if(f(t)){var n=this._trace;if(void 0!==n&&e&&(n=n._parent),void 0!==n)n.attachExtraTrace(t);else if(!t.__stackCleaned__){var r=V(t);l.notEnumerableProp(t,"stack",r.message+"\n"+r.stack.join("\n")),l.notEnumerableProp(t,"__stackCleaned__",!0)}}}function B(t,e,r){if(Y.warnings){var o,i=new u(t);if(e)r._attachExtraTrace(i);else if(Y.longStackTraces&&(o=n._peekContext()))o.attachExtraTrace(i);else{var s=V(i);i.stack=s.message+"\n"+s.stack.join("\n")}T("warning",i)||U(i,"",!0)}}function q(t){for(var e=[],n=0;n<t.length;++n){var r=t[n],o="    (No stack trace)"===r||v.test(r),i=o&&K(r);o&&!i&&(y&&" "!==r.charAt(0)&&(r="    "+r),e.push(r))}return e}function V(t){var e=t.stack,n=t.toString();return e="string"==typeof e&&e.length>0?function(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),n=0;n<e.length;++n){var r=e[n];if("    (No stack trace)"===r||v.test(r))break}return n>0&&"SyntaxError"!=t.name&&(e=e.slice(n)),e}(t):["    (No stack trace)"],{message:n,stack:"SyntaxError"==t.name?e:q(e)}}function U(t,e,n){if("undefined"!=typeof console){var r;if(l.isObject(t)){var o=t.stack;r=e+_(o,t)}else r=e+String(t);"function"==typeof s?s(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}}function Q(t,e,n,r){var o=!1;try{"function"==typeof e&&(o=!0,"rejectionHandled"===t?e(r):e(n,r))}catch(t){c.throwLater(t)}"unhandledRejection"===t?T(t,n,r)||o||U(n,"Unhandled rejection "):T(t,r)}function H(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{if(e=t&&"function"==typeof t.toString?t.toString():l.toString(t),/\[object [a-zA-Z0-9$_]+\]/.test(e))try{var n=JSON.stringify(t);e=n}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+function(t){return t.length<41?t:t.substr(0,38)+"..."}(e)+">, no stack trace)"}function $(){return"function"==typeof X}var K=function(){return!1},z=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function G(t){var e=t.match(z);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function W(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);X(this,W),e>32&&this.uncycle()}l.inherits(W,Error),r.CapturedTrace=W,W.prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],n={},r=0,o=this;void 0!==o;++r)e.push(o),o=o._parent;for(var r=(t=this._length=r)-1;r>=0;--r){var i=e[r].stack;void 0===n[i]&&(n[i]=r)}for(var r=0;r<t;++r){var s=e[r].stack,a=n[s];if(void 0!==a&&a!==r){a>0&&(e[a-1]._parent=void 0,e[a-1]._length=1),e[r]._parent=void 0,e[r]._length=1;var c=r>0?e[r-1]:this;a<t-1?(c._parent=e[a+1],c._parent.uncycle(),c._length=c._parent._length+1):(c._parent=void 0,c._length=1);for(var u=c._length+1,l=r-2;l>=0;--l)e[l]._length=u,u++;return}}}},W.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=V(t),n=e.message,r=[e.stack],o=this;void 0!==o;)r.push(q(o.stack.split("\n"))),o=o._parent;!function(t){for(var e=t[0],n=1;n<t.length;++n){for(var r=t[n],o=e.length-1,i=e[o],s=-1,a=r.length-1;a>=0;--a)if(r[a]===i){s=a;break}for(var a=s;a>=0;--a){var c=r[a];if(e[o]!==c)break;e.pop(),o--}e=r}}(r),function(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}(r),l.notEnumerableProp(t,"stack",function(t,e){for(var n=0;n<e.length-1;++n)e[n].push("From previous event:"),e[n]=e[n].join("\n");return n<e.length&&(e[n]=e[n].join("\n")),t+"\n"+e.join("\n")}(n,r)),l.notEnumerableProp(t,"__stackCleaned__",!0)}};var X=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():H(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,v=t,_=e;var n=Error.captureStackTrace;return K=function(t){return p.test(t)},function(t,e){Error.stackTraceLimit+=6,n(t,e),Error.stackTraceLimit-=6}}var r,o=new Error;if("string"==typeof o.stack&&o.stack.split("\n")[0].indexOf("stackDetection@")>=0)return v=/@/,_=e,y=!0,function(t){t.stack=(new Error).stack};try{throw new Error}catch(t){r="stack"in t}return"stack"in o||!r||"number"!=typeof Error.stackTraceLimit?(_=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?H(e):e.toString()},null):(v=t,_=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(s=function(t){console.warn(t)},l.isNode&&e.stderr.isTTY?s=function(t,e){var n=e?"[33m":"[31m";console.warn(n+t+"[0m\n")}:l.isNode||"string"!=typeof(new Error).stack||(s=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var Y={warnings:m,longStackTraces:!1,cancellation:!1,monitoring:!1};return b&&n.longStackTraces(),{longStackTraces:function(){return Y.longStackTraces},warnings:function(){return Y.warnings},cancellation:function(){return Y.cancellation},monitoring:function(){return Y.monitoring},propagateFromFunction:function(){return M},boundValueFunction:function(){return N},checkForgottenReturns:function(t,e,n,r,o){if(void 0===t&&null!==e&&w){if(void 0!==o&&o._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var i="",s="";if(e._trace){for(var a=e._trace.stack.split("\n"),c=q(a),u=c.length-1;u>=0;--u){var l=c[u];if(!h.test(l)){var f=l.match(d);f&&(i="at "+f[1]+":"+f[2]+":"+f[3]+" ");break}}if(c.length>0)for(var p=c[0],u=0;u<a.length;++u)if(a[u]===p){u>0&&(s="\n"+a[u-1]);break}}var v="a promise was created in a "+n+"handler "+i+"but was not returned from it, see http://goo.gl/rRqMUw"+s;r._warn(v,!0,e)}},setBounds:function(t,e){if($()){for(var n,r,o=t.stack.split("\n"),i=e.stack.split("\n"),s=-1,a=-1,c=0;c<o.length;++c){var u=G(o[c]);if(u){n=u.fileName,s=u.line;break}}for(var c=0;c<i.length;++c){var u=G(i[c]);if(u){r=u.fileName,a=u.line;break}}s<0||a<0||!n||!r||n!==r||s>=a||(K=function(t){if(p.test(t))return!0;var e=G(t);return!!(e&&e.fileName===n&&s<=e.line&&e.line<=a)})}},warn:B,deprecated:function(t,e){var n=t+" is deprecated and will be removed in a future version.";return e&&(n+=" Use "+e+" instead."),B(n)},CapturedTrace:W,fireDomEvent:C,fireGlobalEvent:k}}},{"./errors":12,"./util":36}],10:[function(t,e,n){"use strict";e.exports=function(t){function e(){return this.value}function n(){throw this.reason}t.prototype.return=t.prototype.thenReturn=function(n){return n instanceof t&&n.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:n},void 0)},t.prototype.throw=t.prototype.thenThrow=function(t){return this._then(n,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:t},void 0);var e=arguments[1];return this.caught(t,function(){throw e})},t.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof t&&n.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:n},void 0);var r=arguments[1];return r instanceof t&&r.suppressUnhandledRejections(),this.caught(n,function(){return r})}}},{}],11:[function(t,e,n){"use strict";e.exports=function(t,e){var n=t.reduce,r=t.all;function o(){return r(this)}t.prototype.each=function(t){return n(this,t,e,0)._then(o,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return n(this,t,e,e)},t.each=function(t,r){return n(t,r,e,0)._then(o,void 0,void 0,t,void 0)},t.mapSeries=function(t,r){return n(t,r,e,e)}}},{}],12:[function(t,e,n){"use strict";var r,o,i=t("./es5"),s=i.freeze,a=t("./util"),c=a.inherits,u=a.notEnumerableProp;function l(t,e){function n(r){if(!(this instanceof n))return new n(r);u(this,"message","string"==typeof r?r:e),u(this,"name",t),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return c(n,Error),n}var f=l("Warning","warning"),p=l("CancellationError","cancellation error"),h=l("TimeoutError","timeout error"),d=l("AggregateError","aggregate error");try{r=TypeError,o=RangeError}catch(t){r=l("TypeError","type error"),o=l("RangeError","range error")}for(var v="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),_=0;_<v.length;++_)"function"==typeof Array.prototype[v[_]]&&(d.prototype[v[_]]=Array.prototype[v[_]]);i.defineProperty(d.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),d.prototype.isOperational=!0;var y=0;function g(t){if(!(this instanceof g))return new g(t);u(this,"name","OperationalError"),u(this,"message",t),this.cause=t,this.isOperational=!0,t instanceof Error?(u(this,"message",t.message),u(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}d.prototype.toString=function(){var t=Array(4*y+1).join(" "),e="\n"+t+"AggregateError of:\n";y++,t=Array(4*y+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",o=r.split("\n"),i=0;i<o.length;++i)o[i]=t+o[i];r=o.join("\n"),e+=r+"\n"}return y--,e},c(g,Error);var m=Error.__BluebirdErrorTypes__;m||(m=s({CancellationError:p,TimeoutError:h,OperationalError:g,RejectionError:g,AggregateError:d}),i.defineProperty(Error,"__BluebirdErrorTypes__",{value:m,writable:!1,enumerable:!1,configurable:!1})),e.exports={Error:Error,TypeError:r,RangeError:o,CancellationError:m.CancellationError,OperationalError:m.OperationalError,TimeoutError:m.TimeoutError,AggregateError:m.AggregateError,Warning:f}},{"./es5":13,"./util":36}],13:[function(t,e,n){var r=function(){"use strict";return void 0===this}();if(r)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return!(n&&!n.writable&&!n.set)}};else{var o={}.hasOwnProperty,i={}.toString,s={}.constructor.prototype,a=function(t){var e=[];for(var n in t)o.call(t,n)&&e.push(n);return e};e.exports={isArray:function(t){try{return"[object Array]"===i.call(t)}catch(t){return!1}},keys:a,names:a,defineProperty:function(t,e,n){return t[e]=n.value,t},getDescriptor:function(t,e){return{value:t[e]}},freeze:function(t){return t},getPrototypeOf:function(t){try{return Object(t).constructor.prototype}catch(t){return s}},isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(t,e,n){"use strict";e.exports=function(t,e){var n=t.map;t.prototype.filter=function(t,r){return n(this,t,r,e)},t.filter=function(t,r,o){return n(t,r,o,e)}}},{}],15:[function(t,e,n){"use strict";e.exports=function(e,n,r){var o=t("./util"),i=e.CancellationError,s=o.errorObj,a=t("./catch_filter")(r);function c(t,e,n){this.promise=t,this.type=e,this.handler=n,this.called=!1,this.cancelPromise=null}function u(t){this.finallyHandler=t}function l(t,e){return null!=t.cancelPromise&&(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0)}function f(){return h.call(this,this.promise._target()._settledValue())}function p(t){if(!l(this,t))return s.e=t,s}function h(t){var o=this.promise,a=this.handler;if(!this.called){this.called=!0;var c=this.isFinallyHandler()?a.call(o._boundValue()):a.call(o._boundValue(),t);if(c===r)return c;if(void 0!==c){o._setReturnedNonUndefined();var h=n(c,o);if(h instanceof e){if(null!=this.cancelPromise){if(h._isCancelled()){var d=new i("late cancellation observer");return o._attachExtraTrace(d),s.e=d,s}h.isPending()&&h._attachCancellationCallback(new u(this))}return h._then(f,p,void 0,this,void 0)}}}return o.isRejected()?(l(this),s.e=t,s):(l(this),t)}return c.prototype.isFinallyHandler=function(){return 0===this.type},u.prototype._resultCancelled=function(){l(this.finallyHandler)},e.prototype._passThrough=function(t,e,n,r){return"function"!=typeof t?this.then():this._then(n,r,void 0,new c(this,e,t),void 0)},e.prototype.lastly=e.prototype.finally=function(t){return this._passThrough(t,0,h,h)},e.prototype.tap=function(t){return this._passThrough(t,1,h)},e.prototype.tapCatch=function(t){var n=arguments.length;if(1===n)return this._passThrough(t,1,void 0,h);var r,i=new Array(n-1),s=0;for(r=0;r<n-1;++r){var c=arguments[r];if(!o.isObject(c))return e.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+o.classString(c)));i[s++]=c}i.length=s;var u=arguments[r];return this._passThrough(a(i,u,this),1,void 0,h)},c}},{"./catch_filter":7,"./util":36}],16:[function(t,e,n){"use strict";e.exports=function(e,n,r,o,i,s){var a=t("./errors"),c=a.TypeError,u=t("./util"),l=u.errorObj,f=u.tryCatch,p=[];function h(t,n,o,i){if(s.cancellation()){var a=new e(r),c=this._finallyPromise=new e(r);this._promise=a.lastly(function(){return c}),a._captureStackTrace(),a._setOnCancel(this)}else{var u=this._promise=new e(r);u._captureStackTrace()}this._stack=i,this._generatorFunction=t,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof o?[o].concat(p):p,this._yieldedPromise=null,this._cancellationPhase=!1}u.inherits(h,i),h.prototype._isResolved=function(){return null===this._promise},h.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},h.prototype._promiseCancelled=function(){if(!this._isResolved()){var t,n=void 0!==this._generator.return;if(n)this._promise._pushContext(),t=f(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var r=new e.CancellationError("generator .return() sentinel");e.coroutine.returnSentinel=r,this._promise._attachExtraTrace(r),this._promise._pushContext(),t=f(this._generator.throw).call(this._generator,r),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(t)}},h.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=f(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},h.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=f(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},h.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof e){var t=this._yieldedPromise;this._yieldedPromise=null,t.cancel()}},h.prototype.promise=function(){return this._promise},h.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},h.prototype._continue=function(t){var n=this._promise;if(t===l)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(t.e,!1);var r=t.value;if(!0===t.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(r);var i=o(r,this._promise);if(i instanceof e||null!==(i=function(t,n,r){for(var i=0;i<n.length;++i){r._pushContext();var s=f(n[i])(t);if(r._popContext(),s===l){r._pushContext();var a=e.reject(l.e);return r._popContext(),a}var c=o(s,r);if(c instanceof e)return c}return null}(i,this._yieldHandlers,this._promise))){var s=(i=i._target())._bitField;0==(50397184&s)?(this._yieldedPromise=i,i._proxy(this,null)):0!=(33554432&s)?e._async.invoke(this._promiseFulfilled,this,i._value()):0!=(16777216&s)?e._async.invoke(this._promiseRejected,this,i._reason()):this._promiseCancelled()}else this._promiseRejected(new c("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(r))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},e.coroutine=function(t,e){if("function"!=typeof t)throw new c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(e).yieldHandler,r=h,o=(new Error).stack;return function(){var e=t.apply(this,arguments),i=new r(void 0,void 0,n,o),s=i.promise();return i._generator=e,i._promiseFulfilled(void 0),s}},e.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new c("expecting a function but got "+u.classString(t));p.push(t)},e.spawn=function(t){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof t)return n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new h(t,this),o=r.promise();return r._run(e.spawn),o}}},{"./errors":12,"./util":36}],17:[function(t,e,n){"use strict";e.exports=function(e,n,r,o,i,s){var a=t("./util");a.canEvaluate,a.tryCatch,a.errorObj,e.join=function(){var t,e=arguments.length-1;e>0&&"function"==typeof arguments[e]&&(t=arguments[e]);var r=[].slice.call(arguments);t&&r.pop();var o=new n(r).promise();return void 0!==t?o.spread(t):o}}},{"./util":36}],18:[function(t,e,n){"use strict";e.exports=function(e,n,r,o,i,s){var a=e._getDomain,c=t("./util"),u=c.tryCatch,l=c.errorObj,f=e._async;function p(t,e,n,r){this.constructor$(t),this._promise._captureStackTrace();var o=a();this._callback=null===o?e:c.domainBind(o,e),this._preservedValues=r===i?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],f.invoke(this._asyncInit,this,void 0)}function h(t,n,o,i){if("function"!=typeof n)return r("expecting a function but got "+c.classString(n));var s=0;if(void 0!==o){if("object"!=typeof o||null===o)return e.reject(new TypeError("options argument must be an object but it is "+c.classString(o)));if("number"!=typeof o.concurrency)return e.reject(new TypeError("'concurrency' must be a number but it is "+c.classString(o.concurrency)));s=o.concurrency}return s="number"==typeof s&&isFinite(s)&&s>=1?s:0,new p(t,n,s,i).promise()}c.inherits(p,n),p.prototype._asyncInit=function(){this._init$(void 0,-2)},p.prototype._init=function(){},p.prototype._promiseFulfilled=function(t,n){var r=this._values,i=this.length(),a=this._preservedValues,c=this._limit;if(n<0){if(r[n=-1*n-1]=t,c>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(c>=1&&this._inFlight>=c)return r[n]=t,this._queue.push(n),!1;null!==a&&(a[n]=t);var f=this._promise,p=this._callback,h=f._boundValue();f._pushContext();var d=u(p).call(h,t,n,i),v=f._popContext();if(s.checkForgottenReturns(d,v,null!==a?"Promise.filter":"Promise.map",f),d===l)return this._reject(d.e),!0;var _=o(d,this._promise);if(_ instanceof e){var y=(_=_._target())._bitField;if(0==(50397184&y))return c>=1&&this._inFlight++,r[n]=_,_._proxy(this,-1*(n+1)),!1;if(0==(33554432&y))return 0!=(16777216&y)?(this._reject(_._reason()),!0):(this._cancel(),!0);d=_._value()}r[n]=d}var g=++this._totalResolved;return g>=i&&(null!==a?this._filter(r,a):this._resolve(r),!0)},p.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,n=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var r=t.pop();this._promiseFulfilled(n[r],r)}},p.prototype._filter=function(t,e){for(var n=e.length,r=new Array(n),o=0,i=0;i<n;++i)t[i]&&(r[o++]=e[i]);r.length=o,this._resolve(r)},p.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(t,e){return h(this,t,e,null)},e.map=function(t,e,n,r){return h(t,e,n,r)}}},{"./util":36}],19:[function(t,e,n){"use strict";e.exports=function(e,n,r,o,i){var s=t("./util"),a=s.tryCatch;e.method=function(t){if("function"!=typeof t)throw new e.TypeError("expecting a function but got "+s.classString(t));return function(){var r=new e(n);r._captureStackTrace(),r._pushContext();var o=a(t).apply(this,arguments),s=r._popContext();return i.checkForgottenReturns(o,s,"Promise.method",r),r._resolveFromSyncValue(o),r}},e.attempt=e.try=function(t){if("function"!=typeof t)return o("expecting a function but got "+s.classString(t));var r,c=new e(n);if(c._captureStackTrace(),c._pushContext(),arguments.length>1){i.deprecated("calling Promise.try with more than 1 argument");var u=arguments[1],l=arguments[2];r=s.isArray(u)?a(t).apply(l,u):a(t).call(l,u)}else r=a(t)();var f=c._popContext();return i.checkForgottenReturns(r,f,"Promise.try",c),c._resolveFromSyncValue(r),c},e.prototype._resolveFromSyncValue=function(t){t===s.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},{"./util":36}],20:[function(t,e,n){"use strict";var r=t("./util"),o=r.maybeWrapAsError,i=t("./errors"),s=i.OperationalError,a=t("./es5"),c=/^(?:name|message|stack|cause)$/;function u(t){var e;if(function(t){return t instanceof Error&&a.getPrototypeOf(t)===Error.prototype}(t)){(e=new s(t)).name=t.name,e.message=t.message,e.stack=t.stack;for(var n=a.keys(t),o=0;o<n.length;++o){var i=n[o];c.test(i)||(e[i]=t[i])}return e}return r.markAsOriginatingFromRejection(t),t}e.exports=function(t,e){return function(n,r){if(null!==t){if(n){var i=u(o(n));t._attachExtraTrace(i),t._reject(i)}else if(e){var s=[].slice.call(arguments,1);t._fulfill(s)}else t._fulfill(r);t=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(t,e,n){"use strict";e.exports=function(e){var n=t("./util"),r=e._async,o=n.tryCatch,i=n.errorObj;function s(t,e){if(!n.isArray(t))return a.call(this,t,e);var s=o(e).apply(this._boundValue(),[null].concat(t));s===i&&r.throwLater(s.e)}function a(t,e){var n=this._boundValue(),s=void 0===t?o(e).call(n,null):o(e).call(n,null,t);s===i&&r.throwLater(s.e)}function c(t,e){if(!t){var n=new Error(t+"");n.cause=t,t=n}var s=o(e).call(this._boundValue(),t);s===i&&r.throwLater(s.e)}e.prototype.asCallback=e.prototype.nodeify=function(t,e){if("function"==typeof t){var n=a;void 0!==e&&Object(e).spread&&(n=s),this._then(n,c,void 0,this,t)}return this}}},{"./util":36}],22:[function(t,n,r){"use strict";n.exports=function(){var r=function(){return new d("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},o=function(){return new S.PromiseInspection(this._target())},i=function(t){return S.reject(new d(t))};function s(){}var a,c={},u=t("./util");a=u.isNode?function(){var t=e.domain;return void 0===t&&(t=null),t}:function(){return null},u.notEnumerableProp(S,"_getDomain",a);var l=t("./es5"),f=t("./async"),p=new f;l.defineProperty(S,"_async",{value:p});var h=t("./errors"),d=S.TypeError=h.TypeError;S.RangeError=h.RangeError;var v=S.CancellationError=h.CancellationError;S.TimeoutError=h.TimeoutError,S.OperationalError=h.OperationalError,S.RejectionError=h.OperationalError,S.AggregateError=h.AggregateError;var _=function(){},y={},g={},m=t("./thenables")(S,_),b=t("./promise_array")(S,_,m,i,s),w=t("./context")(S),E=w.create,C=t("./debuggability")(S,w),k=(C.CapturedTrace,t("./finally")(S,m,g)),j=t("./catch_filter")(g),P=t("./nodeback"),T=u.errorObj,x=u.tryCatch;function S(t){t!==_&&function(t,e){if(null==t||t.constructor!==S)throw new d("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof e)throw new d("expecting a function but got "+u.classString(e))}(this,t),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(t),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function R(t){this.promise._resolveCallback(t)}function O(t){this.promise._rejectCallback(t,!1)}function A(t){var e=new S(_);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}return S.prototype.toString=function(){return"[object Promise]"},S.prototype.caught=S.prototype.catch=function(t){var e=arguments.length;if(e>1){var n,r=new Array(e-1),o=0;for(n=0;n<e-1;++n){var s=arguments[n];if(!u.isObject(s))return i("Catch statement predicate: expecting an object but got "+u.classString(s));r[o++]=s}return r.length=o,t=arguments[n],this.then(void 0,j(r,t,this))}return this.then(void 0,t)},S.prototype.reflect=function(){return this._then(o,o,void 0,this,void 0)},S.prototype.then=function(t,e){if(C.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var n=".then() only accepts functions but was passed: "+u.classString(t);arguments.length>1&&(n+=", "+u.classString(e)),this._warn(n)}return this._then(t,e,void 0,void 0,void 0)},S.prototype.done=function(t,e){var n=this._then(t,e,void 0,void 0,void 0);n._setIsFinal()},S.prototype.spread=function(t){return"function"!=typeof t?i("expecting a function but got "+u.classString(t)):this.all()._then(t,void 0,void 0,y,void 0)},S.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},S.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new b(this).promise()},S.prototype.error=function(t){return this.caught(u.originatesFromRejection,t)},S.getNewLibraryCopy=n.exports,S.is=function(t){return t instanceof S},S.fromNode=S.fromCallback=function(t){var e=new S(_);e._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=x(t)(P(e,n));return r===T&&e._rejectCallback(r.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},S.all=function(t){return new b(t).promise()},S.cast=function(t){var e=m(t);return e instanceof S||((e=new S(_))._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},S.resolve=S.fulfilled=S.cast,S.reject=S.rejected=function(t){var e=new S(_);return e._captureStackTrace(),e._rejectCallback(t,!0),e},S.setScheduler=function(t){if("function"!=typeof t)throw new d("expecting a function but got "+u.classString(t));return p.setScheduler(t)},S.prototype._then=function(t,e,n,r,o){var i=void 0!==o,s=i?o:new S(_),c=this._target(),l=c._bitField;i||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&l)?this._boundValue():c===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var f=a();if(0!=(50397184&l)){var h,d,y=c._settlePromiseCtx;0!=(33554432&l)?(d=c._rejectionHandler0,h=t):0!=(16777216&l)?(d=c._fulfillmentHandler0,h=e,c._unsetRejectionIsUnhandled()):(y=c._settlePromiseLateCancellationObserver,d=new v("late cancellation observer"),c._attachExtraTrace(d),h=e),p.invoke(y,c,{handler:null===f?h:"function"==typeof h&&u.domainBind(f,h),promise:s,receiver:r,value:d})}else c._addCallbacks(t,e,s,r,f);return s},S.prototype._length=function(){return 65535&this._bitField},S.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},S.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},S.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},S.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},S.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},S.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},S.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},S.prototype._isFinal=function(){return(4194304&this._bitField)>0},S.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},S.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},S.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},S.prototype._setAsyncGuaranteed=function(){p.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},S.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==c)return void 0===e&&this._isBound()?this._boundValue():e},S.prototype._promiseAt=function(t){return this[4*t-4+2]},S.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},S.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},S.prototype._boundValue=function(){},S.prototype._migrateCallback0=function(t){t._bitField;var e=t._fulfillmentHandler0,n=t._rejectionHandler0,r=t._promise0,o=t._receiverAt(0);void 0===o&&(o=c),this._addCallbacks(e,n,r,o,null)},S.prototype._migrateCallbackAt=function(t,e){var n=t._fulfillmentHandlerAt(e),r=t._rejectionHandlerAt(e),o=t._promiseAt(e),i=t._receiverAt(e);void 0===i&&(i=c),this._addCallbacks(n,r,o,i,null)},S.prototype._addCallbacks=function(t,e,n,r,o){var i=this._length();if(i>=65531&&(i=0,this._setLength(0)),0===i)this._promise0=n,this._receiver0=r,"function"==typeof t&&(this._fulfillmentHandler0=null===o?t:u.domainBind(o,t)),"function"==typeof e&&(this._rejectionHandler0=null===o?e:u.domainBind(o,e));else{var s=4*i-4;this[s+2]=n,this[s+3]=r,"function"==typeof t&&(this[s+0]=null===o?t:u.domainBind(o,t)),"function"==typeof e&&(this[s+1]=null===o?e:u.domainBind(o,e))}return this._setLength(i+1),i},S.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},S.prototype._resolveCallback=function(t,e){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(r(),!1);var n=m(t,this);if(!(n instanceof S))return this._fulfill(t);e&&this._propagateFrom(n,2);var o=n._target();if(o!==this){var i=o._bitField;if(0==(50397184&i)){var s=this._length();s>0&&o._migrateCallback0(this);for(var a=1;a<s;++a)o._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(o)}else if(0!=(33554432&i))this._fulfill(o._value());else if(0!=(16777216&i))this._reject(o._reason());else{var c=new v("late cancellation observer");o._attachExtraTrace(c),this._reject(c)}}else this._reject(r())}},S.prototype._rejectCallback=function(t,e,n){var r=u.ensureErrorObject(t),o=r===t;if(!o&&!n&&C.warnings()){var i="a promise was rejected with a non-error: "+u.classString(t);this._warn(i,!0)}this._attachExtraTrace(r,!!e&&o),this._reject(t)},S.prototype._resolveFromExecutor=function(t){if(t!==_){var e=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,n)});n=!1,this._popContext(),void 0!==r&&e._rejectCallback(r,!0)}},S.prototype._settlePromiseFromHandler=function(t,e,n,r){var o=r._bitField;if(0==(65536&o)){var i;r._pushContext(),e===y?n&&"number"==typeof n.length?i=x(t).apply(this._boundValue(),n):(i=T).e=new d("cannot .spread() a non-array: "+u.classString(n)):i=x(t).call(e,n);var s=r._popContext();0==(65536&(o=r._bitField))&&(i===g?r._reject(n):i===T?r._rejectCallback(i.e,!1):(C.checkForgottenReturns(i,s,"",r,this),r._resolveCallback(i)))}},S.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},S.prototype._followee=function(){return this._rejectionHandler0},S.prototype._setFollowee=function(t){this._rejectionHandler0=t},S.prototype._settlePromise=function(t,e,n,r){var i=t instanceof S,a=this._bitField,c=0!=(134217728&a);0!=(65536&a)?(i&&t._invokeInternalOnCancel(),n instanceof k&&n.isFinallyHandler()?(n.cancelPromise=t,x(e).call(n,r)===T&&t._reject(T.e)):e===o?t._fulfill(o.call(n)):n instanceof s?n._promiseCancelled(t):i||t instanceof b?t._cancel():n.cancel()):"function"==typeof e?i?(c&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,n,r,t)):e.call(n,r,t):n instanceof s?n._isResolved()||(0!=(33554432&a)?n._promiseFulfilled(r,t):n._promiseRejected(r,t)):i&&(c&&t._setAsyncGuaranteed(),0!=(33554432&a)?t._fulfill(r):t._reject(r))},S.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,n=t.promise,r=t.receiver,o=t.value;"function"==typeof e?n instanceof S?this._settlePromiseFromHandler(e,r,o,n):e.call(r,o,n):n instanceof S&&n._reject(o)},S.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},S.prototype._settlePromise0=function(t,e,n){var r=this._promise0,o=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,t,o,e)},S.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},S.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var n=r();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=t,(65535&e)>0&&(0!=(134217728&e)?this._settlePromises():p.settlePromises(this))}},S.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=t,this._isFinal())return p.fatalError(t,u.isNode);(65535&e)>0?p.settlePromises(this):this._ensurePossibleRejectionHandled()}},S.prototype._fulfillPromises=function(t,e){for(var n=1;n<t;n++){var r=this._fulfillmentHandlerAt(n),o=this._promiseAt(n),i=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(o,r,i,e)}},S.prototype._rejectPromises=function(t,e){for(var n=1;n<t;n++){var r=this._rejectionHandlerAt(n),o=this._promiseAt(n),i=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(o,r,i,e)}},S.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!=(16842752&t)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,t),this._rejectPromises(e,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,t),this._fulfillPromises(e,r)}this._setLength(0)}this._clearCancellationData()},S.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},S.defer=S.pending=function(){C.deprecated("Promise.defer","new Promise");var t=new S(_);return{promise:t,resolve:R,reject:O}},u.notEnumerableProp(S,"_makeSelfResolutionError",r),t("./method")(S,_,m,i,C),t("./bind")(S,_,m,C),t("./cancel")(S,b,i,C),t("./direct_resolve")(S),t("./synchronous_inspection")(S),t("./join")(S,b,m,_,p,a),S.Promise=S,S.version="3.5.1",t("./map.js")(S,b,i,m,_,C),t("./call_get.js")(S),t("./using.js")(S,i,m,E,_,C),t("./timers.js")(S,_,C),t("./generators.js")(S,i,_,m,s,C),t("./nodeify.js")(S),t("./promisify.js")(S,_),t("./props.js")(S,b,m,i),t("./race.js")(S,_,m,i),t("./reduce.js")(S,b,i,m,_,C),t("./settle.js")(S,b,C),t("./some.js")(S,b,i),t("./filter.js")(S,_),t("./each.js")(S,_),t("./any.js")(S),u.toFastProperties(S),u.toFastProperties(S.prototype),A({a:1}),A({b:2}),A({c:3}),A(1),A(function(){}),A(void 0),A(!1),A(new S(_)),C.setBounds(f.firstLineError,u.lastLineError),S}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(t,e,n){"use strict";e.exports=function(e,n,r,o,i){var s=t("./util");function a(t){var r=this._promise=new e(n);t instanceof e&&r._propagateFrom(t,3),r._setOnCancel(this),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return s.isArray,s.inherits(a,i),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function t(n,i){var a=r(this._values,this._promise);if(a instanceof e){var c=(a=a._target())._bitField;if(this._values=a,0==(50397184&c))return this._promise._setAsyncGuaranteed(),a._then(t,this._reject,void 0,this,i);if(0==(33554432&c))return 0!=(16777216&c)?this._reject(a._reason()):this._cancel();a=a._value()}if(null!==(a=s.asArray(a)))0!==a.length?this._iterate(a):-5===i?this._resolveEmptyArray():this._resolve(function(t){switch(t){case-2:return[];case-3:return{};case-6:return new Map}}(i));else{var u=o("expecting an array or an iterable object but got "+s.classString(a)).reason();this._promise._rejectCallback(u,!1)}},a.prototype._iterate=function(t){var n=this.getActualLength(t.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var o=this._promise,i=!1,s=null,a=0;a<n;++a){var c=r(t[a],o);c instanceof e?(c=c._target(),s=c._bitField):s=null,i?null!==s&&c.suppressUnhandledRejections():null!==s?0==(50397184&s)?(c._proxy(this,a),this._values[a]=c):i=0!=(33554432&s)?this._promiseFulfilled(c._value(),a):0!=(16777216&s)?this._promiseRejected(c._reason(),a):this._promiseCancelled(a):i=this._promiseFulfilled(c,a)}i||o._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},a.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var n=++this._totalResolved;return n>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var n=0;n<t.length;++n)t[n]instanceof e&&t[n].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(t){return t},a}},{"./util":36}],24:[function(t,e,n){"use strict";e.exports=function(e,n){var r={},o=t("./util"),i=t("./nodeback"),s=o.withAppended,a=o.maybeWrapAsError,c=o.canEvaluate,u=t("./errors").TypeError,l={__isPromisified__:!0},f=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),p=function(t){return o.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t};function h(t){return!f.test(t)}function d(t){try{return!0===t.__isPromisified__}catch(t){return!1}}function v(t,e,n){var r=o.getDataPropertyOrDefault(t,e+n,l);return!!r&&d(r)}function _(t,e,n,r){for(var i=o.inheritedDataKeys(t),s=[],a=0;a<i.length;++a){var c=i[a],l=t[c],f=r===p||p(c,l,t);"function"!=typeof l||d(l)||v(t,c,e)||!r(c,l,t,f)||s.push(c,l)}return function(t,e,n){for(var r=0;r<t.length;r+=2){var o=t[r];if(n.test(o))for(var i=o.replace(n,""),s=0;s<t.length;s+=2)if(t[s]===i)throw new u("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}(s,e,n),s}var y=function(t){return t.replace(/([$])/,"\\$")},g=c?void 0:function(t,c,u,l,f,p){var h=function(){return this}(),d=t;function v(){var o=c;c===r&&(o=this);var u=new e(n);u._captureStackTrace();var l="string"==typeof d&&this!==h?this[d]:t,f=i(u,p);try{l.apply(o,s(arguments,f))}catch(t){u._rejectCallback(a(t),!0,!0)}return u._isFateSealed()||u._setAsyncGuaranteed(),u}return"string"==typeof d&&(t=l),o.notEnumerableProp(v,"__isPromisified__",!0),v};function m(t,e,n,i,s){for(var a=new RegExp(y(e)+"$"),c=_(t,e,a,n),u=0,l=c.length;u<l;u+=2){var f=c[u],p=c[u+1],h=f+e;if(i===g)t[h]=g(f,r,f,p,e,s);else{var d=i(p,function(){return g(f,r,f,p,e,s)});o.notEnumerableProp(d,"__isPromisified__",!0),t[h]=d}}return o.toFastProperties(t),t}e.promisify=function(t,e){if("function"!=typeof t)throw new u("expecting a function but got "+o.classString(t));if(d(t))return t;var n=void 0===(e=Object(e)).context?r:e.context,i=!!e.multiArgs,s=function(t,e,n){return g(t,e,void 0,t,null,n)}(t,n,i);return o.copyDescriptors(t,s,h),s},e.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new u("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(e=Object(e)).multiArgs,r=e.suffix;"string"!=typeof r&&(r="Async");var i=e.filter;"function"!=typeof i&&(i=p);var s=e.promisifier;if("function"!=typeof s&&(s=g),!o.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=o.inheritedDataKeys(t),c=0;c<a.length;++c){var l=t[a[c]];"constructor"!==a[c]&&o.isClass(l)&&(m(l.prototype,r,i,s,n),m(l,r,i,s,n))}return m(t,r,i,s,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(t,e,n){"use strict";e.exports=function(e,n,r,o){var i,s=t("./util"),a=s.isObject,c=t("./es5");"function"==typeof Map&&(i=Map);var u=function(){var t=0,e=0;function n(n,r){this[t]=n,this[t+e]=r,t++}return function(r){e=r.size,t=0;var o=new Array(2*r.size);return r.forEach(n,o),o}}();function l(t){var e,n=!1;if(void 0!==i&&t instanceof i)e=u(t),n=!0;else{var r=c.keys(t),o=r.length;e=new Array(2*o);for(var s=0;s<o;++s){var a=r[s];e[s]=t[a],e[s+o]=a}}this.constructor$(e),this._isMap=n,this._init$(void 0,n?-6:-3)}function f(t){var n,i=r(t);return a(i)?(n=i instanceof e?i._then(e.props,void 0,void 0,void 0,void 0):new l(i).promise(),i instanceof e&&n._propagateFrom(i,2),n):o("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}s.inherits(l,n),l.prototype._init=function(){},l.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var n=++this._totalResolved;if(n>=this._length){var r;if(this._isMap)r=function(t){for(var e=new i,n=t.length/2|0,r=0;r<n;++r){var o=t[n+r],s=t[r];e.set(o,s)}return e}(this._values);else{r={};for(var o=this.length(),s=0,a=this.length();s<a;++s)r[this._values[s+o]]=this._values[s]}return this._resolve(r),!0}return!1},l.prototype.shouldCopyValues=function(){return!1},l.prototype.getActualLength=function(t){return t>>1},e.prototype.props=function(){return f(this)},e.props=function(t){return f(t)}}},{"./es5":13,"./util":36}],26:[function(t,e,n){"use strict";function r(t){this._capacity=t,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(t){return this._capacity<t},r.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1);var n=this._front+e&this._capacity-1;this[n]=t,this._length=e+1},r.prototype.push=function(t,e,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(t),this._pushOne(e),void this._pushOne(n);var o=this._front+r-3;this._checkCapacity(r);var i=this._capacity-1;this[o+0&i]=t,this[o+1&i]=e,this[o+2&i]=n,this._length=r},r.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t;var n=this._front,r=this._length,o=n+r&e-1;!function(t,e,n,r,o){for(var i=0;i<o;++i)n[i+r]=t[i+e],t[i+e]=void 0}(this,0,this,e,o)},e.exports=r},{}],27:[function(t,e,n){"use strict";e.exports=function(e,n,r,o){var i=t("./util"),s=function(t){return t.then(function(e){return a(e,t)})};function a(t,a){var c=r(t);if(c instanceof e)return s(c);if(null===(t=i.asArray(t)))return o("expecting an array or an iterable object but got "+i.classString(t));var u=new e(n);void 0!==a&&u._propagateFrom(a,3);for(var l=u._fulfill,f=u._reject,p=0,h=t.length;p<h;++p){var d=t[p];(void 0!==d||p in t)&&e.cast(d)._then(l,f,void 0,u,null)}return u}e.race=function(t){return a(t,void 0)},e.prototype.race=function(){return a(this,void 0)}}},{"./util":36}],28:[function(t,e,n){"use strict";e.exports=function(e,n,r,o,i,s){var a=e._getDomain,c=t("./util"),u=c.tryCatch;function l(t,n,r,o){this.constructor$(t);var s=a();this._fn=null===s?n:c.domainBind(s,n),void 0!==r&&(r=e.resolve(r))._attachCancellationCallback(this),this._initialValue=r,this._currentCancellable=null,this._eachValues=o===i?Array(this._length):0===o?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function f(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function p(t,e,n,o){if("function"!=typeof e)return r("expecting a function but got "+c.classString(e));var i=new l(t,e,n,o);return i.promise()}function h(t){this.accum=t,this.array._gotAccum(t);var n=o(this.value,this.array._promise);return n instanceof e?(this.array._currentCancellable=n,n._then(d,void 0,void 0,this,void 0)):d.call(this,n)}function d(t){var n,r=this.array,o=r._promise,i=u(r._fn);o._pushContext(),(n=void 0!==r._eachValues?i.call(o._boundValue(),t,this.index,this.length):i.call(o._boundValue(),this.accum,t,this.index,this.length))instanceof e&&(r._currentCancellable=n);var a=o._popContext();return s.checkForgottenReturns(n,a,void 0!==r._eachValues?"Promise.each":"Promise.reduce",o),n}c.inherits(l,n),l.prototype._gotAccum=function(t){void 0!==this._eachValues&&null!==this._eachValues&&t!==i&&this._eachValues.push(t)},l.prototype._eachComplete=function(t){return null!==this._eachValues&&this._eachValues.push(t),this._eachValues},l.prototype._init=function(){},l.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},l.prototype.shouldCopyValues=function(){return!1},l.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},l.prototype._resultCancelled=function(t){if(t===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel())},l.prototype._iterate=function(t){var n,r;this._values=t;var o=t.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=e.resolve(t[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;r<o;++r){var i={accum:null,value:t[r],index:r,length:o,array:this};n=n._then(h,void 0,void 0,i,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(f,f,void 0,n,this)},e.prototype.reduce=function(t,e){return p(this,t,e,null)},e.reduce=function(t,e,n,r){return p(t,e,n,r)}}},{"./util":36}],29:[function(t,o,i){"use strict";var s,a,c,u,l,f=t("./util"),p=f.getNativePromise();if(f.isNode&&"undefined"==typeof MutationObserver){var h=n.setImmediate,d=e.nextTick;s=f.isRecentNode?function(t){h.call(n,t)}:function(t){d.call(e,t)}}else if("function"==typeof p&&"function"==typeof p.resolve){var v=p.resolve();s=function(t){v.then(t)}}else s="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?void 0!==r?function(t){r(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:(a=document.createElement("div"),c={attributes:!0},u=!1,l=document.createElement("div"),new MutationObserver(function(){a.classList.toggle("foo"),u=!1}).observe(l,c),function(t){var e=new MutationObserver(function(){e.disconnect(),t()});e.observe(a,c),u||(u=!0,l.classList.toggle("foo"))});o.exports=s},{"./util":36}],30:[function(t,e,n){"use strict";e.exports=function(e,n,r){var o=e.PromiseInspection,i=t("./util");function s(t){this.constructor$(t)}i.inherits(s,n),s.prototype._promiseResolved=function(t,e){this._values[t]=e;var n=++this._totalResolved;return n>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseFulfilled=function(t,e){var n=new o;return n._bitField=33554432,n._settledValueField=t,this._promiseResolved(e,n)},s.prototype._promiseRejected=function(t,e){var n=new o;return n._bitField=16777216,n._settledValueField=t,this._promiseResolved(e,n)},e.settle=function(t){return r.deprecated(".settle()",".reflect()"),new s(t).promise()},e.prototype.settle=function(){return e.settle(this)}}},{"./util":36}],31:[function(t,e,n){"use strict";e.exports=function(e,n,r){var o=t("./util"),i=t("./errors").RangeError,s=t("./errors").AggregateError,a=o.isArray,c={};function u(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function l(t,e){if((0|e)!==e||e<0)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new u(t),o=n.promise();return n.setHowMany(e),n.init(),o}o.inherits(u,n),u.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var t=a(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},u.prototype.init=function(){this._initialized=!0,this._init()},u.prototype.setUnwrap=function(){this._unwrap=!0},u.prototype.howMany=function(){return this._howMany},u.prototype.setHowMany=function(t){this._howMany=t},u.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},u.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},u.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(c),this._checkOutcome())},u.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new s,e=this.length();e<this._values.length;++e)this._values[e]!==c&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},u.prototype._fulfilled=function(){return this._totalResolved},u.prototype._rejected=function(){return this._values.length-this.length()},u.prototype._addRejected=function(t){this._values.push(t)},u.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},u.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},u.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new i(e)},u.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(t,e){return l(t,e)},e.prototype.some=function(t){return l(this,t)},e._SomePromiseArray=u}},{"./errors":12,"./util":36}],32:[function(t,e,n){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var n=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},o=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},i=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},t.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype._isCancelled=function(){return this._target().__isCancelled()},t.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},t.prototype.isPending=function(){return s.call(this._target())},t.prototype.isRejected=function(){return i.call(this._target())},t.prototype.isFulfilled=function(){return o.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return n.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),r.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},{}],33:[function(t,e,n){"use strict";e.exports=function(e,n){var r=t("./util"),o=r.errorObj,i=r.isObject,s={}.hasOwnProperty;return function(t,a){if(i(t)){if(t instanceof e)return t;var c=function(t){try{return function(t){return t.then}(t)}catch(t){return o.e=t,o}}(t);if(c===o){a&&a._pushContext();var u=e.reject(c.e);return a&&a._popContext(),u}if("function"==typeof c){if(function(t){try{return s.call(t,"_promise0")}catch(t){return!1}}(t)){var u=new e(n);return t._then(u._fulfill,u._reject,void 0,u,null),u}return function(t,i,s){var a=new e(n),c=a;s&&s._pushContext(),a._captureStackTrace(),s&&s._popContext();var u=!0,l=r.tryCatch(i).call(t,function(t){a&&(a._resolveCallback(t),a=null)},function(t){a&&(a._rejectCallback(t,u,!0),a=null)});return u=!1,a&&l===o&&(a._rejectCallback(l.e,!0,!0),a=null),c}(t,c,a)}}return t}}},{"./util":36}],34:[function(t,e,n){"use strict";e.exports=function(e,n,r){var o=t("./util"),i=e.TimeoutError;function s(t){this.handle=t}s.prototype._resultCancelled=function(){clearTimeout(this.handle)};var a=function(t){return c(+this).thenReturn(t)},c=e.delay=function(t,o){var i,c;return void 0!==o?(i=e.resolve(o)._then(a,null,null,t,void 0),r.cancellation()&&o instanceof e&&i._setOnCancel(o)):(i=new e(n),c=setTimeout(function(){i._fulfill()},+t),r.cancellation()&&i._setOnCancel(new s(c)),i._captureStackTrace()),i._setAsyncGuaranteed(),i};function u(t){return clearTimeout(this.handle),t}function l(t){throw clearTimeout(this.handle),t}e.prototype.delay=function(t){return c(t,this)},e.prototype.timeout=function(t,e){var n,a;t=+t;var c=new s(setTimeout(function(){n.isPending()&&function(t,e,n){var r;r="string"!=typeof e?e instanceof Error?e:new i("operation timed out"):new i(e),o.markAsOriginatingFromRejection(r),t._attachExtraTrace(r),t._reject(r),null!=n&&n.cancel()}(n,e,a)},t));return r.cancellation()?(a=this.then(),(n=a._then(u,l,void 0,c,void 0))._setOnCancel(c)):n=this._then(u,l,void 0,c,void 0),n}}},{"./util":36}],35:[function(t,e,n){"use strict";e.exports=function(e,n,r,o,i,s){var a=t("./util"),c=t("./errors").TypeError,u=t("./util").inherits,l=a.errorObj,f=a.tryCatch,p={};function h(t){setTimeout(function(){throw t},0)}function d(t,n){var o=0,s=t.length,a=new e(i);return function i(){if(o>=s)return a._fulfill();var c=function(t){var e=r(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}(t[o++]);if(c instanceof e&&c._isDisposable()){try{c=r(c._getDisposer().tryDispose(n),t.promise)}catch(t){return h(t)}if(c instanceof e)return c._then(i,h,null,null,null)}i()}(),a}function v(t,e,n){this._data=t,this._promise=e,this._context=n}function _(t,e,n){this.constructor$(t,e,n)}function y(t){return v.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function g(t){this.length=t,this.promise=null,this[t-1]=null}v.prototype.data=function(){return this._data},v.prototype.promise=function(){return this._promise},v.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():p},v.prototype.tryDispose=function(t){var e=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=e!==p?this.doDispose(e,t):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},v.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},u(_,v),_.prototype.doDispose=function(t,e){var n=this.data();return n.call(t,t,e)},g.prototype._resultCancelled=function(){for(var t=this.length,n=0;n<t;++n){var r=this[n];r instanceof e&&r.cancel()}},e.using=function(){var t=arguments.length;if(t<2)return n("you must pass at least 2 arguments to Promise.using");var o,i=arguments[t-1];if("function"!=typeof i)return n("expecting a function but got "+a.classString(i));var c=!0;2===t&&Array.isArray(arguments[0])?(o=arguments[0],t=o.length,c=!1):(o=arguments,t--);for(var u=new g(t),p=0;p<t;++p){var h=o[p];if(v.isDisposer(h)){var _=h;(h=h.promise())._setDisposable(_)}else{var m=r(h);m instanceof e&&(h=m._then(y,null,null,{resources:u,index:p},void 0))}u[p]=h}for(var b=new Array(u.length),p=0;p<b.length;++p)b[p]=e.resolve(u[p]).reflect();var w=e.all(b).then(function(t){for(var e=0;e<t.length;++e){var n=t[e];if(n.isRejected())return l.e=n.error(),l;if(!n.isFulfilled())return void w.cancel();t[e]=n.value()}E._pushContext(),i=f(i);var r=c?i.apply(void 0,t):i(t),o=E._popContext();return s.checkForgottenReturns(r,o,"Promise.using",E),r}),E=w.lastly(function(){var t=new e.PromiseInspection(w);return d(u,t)});return u.promise=E,E._setOnCancel(u),E},e.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},e.prototype._isDisposable=function(){return(131072&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},e.prototype.disposer=function(t){if("function"==typeof t)return new _(t,this,o());throw new c}}},{"./errors":12,"./util":36}],36:[function(t,r,o){"use strict";var i=t("./es5"),s="undefined"==typeof navigator,a={e:{}},c,u="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:void 0!==this?this:null;function l(){try{var t=c;return c=null,t.apply(this,arguments)}catch(t){return a.e=t,a}}function f(t){return c=t,l}var p=function(t,e){var n={}.hasOwnProperty;function r(){for(var r in this.constructor=t,this.constructor$=e,e.prototype)n.call(e.prototype,r)&&"$"!==r.charAt(r.length-1)&&(this[r+"$"]=e.prototype[r])}return r.prototype=e.prototype,t.prototype=new r,t.prototype};function h(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function d(t){return"function"==typeof t||"object"==typeof t&&null!==t}function v(t){return h(t)?new Error(T(t)):t}function _(t,e){var n,r=t.length,o=new Array(r+1);for(n=0;n<r;++n)o[n]=t[n];return o[n]=e,o}function y(t,e,n){if(!i.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var r=Object.getOwnPropertyDescriptor(t,e);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function g(t,e,n){if(h(t))return t;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return i.defineProperty(t,e,r),t}function m(t){throw t}var b=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var n=0;n<t.length;++n)if(t[n]===e)return!0;return!1};if(i.isES5){var n=Object.getOwnPropertyNames;return function(t){for(var r=[],o=Object.create(null);null!=t&&!e(t);){var s;try{s=n(t)}catch(t){return r}for(var a=0;a<s.length;++a){var c=s[a];if(!o[c]){o[c]=!0;var u=Object.getOwnPropertyDescriptor(t,c);null!=u&&null==u.get&&null==u.set&&r.push(c)}}t=i.getPrototypeOf(t)}return r}}var r={}.hasOwnProperty;return function(n){if(e(n))return[];var o=[];t:for(var i in n)if(r.call(n,i))o.push(i);else{for(var s=0;s<t.length;++s)if(r.call(t[s],i))continue t;o.push(i)}return o}}(),w=/this\s*\.\s*\S+\s*=/;function E(t){try{if("function"==typeof t){var e=i.names(t.prototype),n=i.isES5&&e.length>1,r=e.length>0&&!(1===e.length&&"constructor"===e[0]),o=w.test(t+"")&&i.names(t).length>0;if(n||r||o)return!0}return!1}catch(t){return!1}}function C(t){function e(){}e.prototype=t;for(var n=8;n--;)new e;return t}var k=/^[a-z$_][a-z$_0-9]*$/i;function j(t){return k.test(t)}function P(t,e,n){for(var r=new Array(t),o=0;o<t;++o)r[o]=e+o+n;return r}function T(t){try{return t+""}catch(t){return"[no string representation]"}}function x(t){return t instanceof Error||null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function S(t){try{g(t,"isOperational",!0)}catch(t){}}function R(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)}function O(t){return x(t)&&i.propertyIsWritable(t,"stack")}var A="stack"in new Error?function(t){return O(t)?t:new Error(T(t))}:function(t){if(O(t))return t;try{throw new Error(T(t))}catch(t){return t}};function F(t){return{}.toString.call(t)}function I(t,e,n){for(var r=i.names(t),o=0;o<r.length;++o){var s=r[o];if(n(s))try{i.defineProperty(e,s,i.getDescriptor(t,s))}catch(t){}}}var M=function(t){return i.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var N="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,n=[],r=t[Symbol.iterator]();!(e=r.next()).done;)n.push(e.value);return n};M=function(t){return i.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?N(t):null}}var D=void 0!==e&&"[object process]"===F(e).toLowerCase(),L=void 0!==e&&void 0!==e.env;function B(t){return L?e.env[t]:void 0}function q(){if("function"==typeof Promise)try{var t=new Promise(function(){});if("[object Promise]"==={}.toString.call(t))return Promise}catch(t){}}function V(t,e){return t.bind(e)}var U={isClass:E,isIdentifier:j,inheritedDataKeys:b,getDataPropertyOrDefault:y,thrower:m,isArray:i.isArray,asArray:M,notEnumerableProp:g,isPrimitive:h,isObject:d,isError:x,canEvaluate:s,errorObj:a,tryCatch:f,inherits:p,withAppended:_,maybeWrapAsError:v,toFastProperties:C,filledRange:P,toString:T,canAttachTrace:O,ensureErrorObject:A,originatesFromRejection:R,markAsOriginatingFromRejection:S,classString:F,copyDescriptors:I,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:D,hasEnvVariables:L,env:B,global:u,getNativePromise:q,domainBind:V},Q;U.isRecentNode=U.isNode&&(Q=e.versions.node.split(".").map(Number),0===Q[0]&&Q[1]>10||Q[0]>0),U.isNode&&U.toFastProperties(e);try{throw new Error}catch(t){U.lastLineError=t}r.exports=U},{"./es5":13}]},{},[4])(4)}(),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,n(0),n(1),n(7).setImmediate)},function(t,e){t.exports={SERVER_CHOOSES_BEST_MOVE:{id:"SERVER_CHOOSES_BEST_MOVE",description:"'Call A Friend': Let Stockfish pick the best of your 3 moves!"},MAX_FIVE_CHOICES:{id:"MAX_FIVE_CHOICES",description:"'The Fiver': Choose up to 5 moves. Combine with 'Call a Friend' for superpowers."}}},function(t,e){t.exports={STOCKFISH_LEVEL:5,AFTER_RANK_WAIT_TIME:5e3,MAX_RANKED_MOVES:3,PLAYER_SIDE:"white"}},function(t,e){t.exports={ANNOTATION_LIFETIME:5e3}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e,n){(function(t,r){var o=/%[sdj%]/g;e.format=function(t){if(!y(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(a(arguments[n]));return e.join(" ")}n=1;for(var r=arguments,i=r.length,s=String(t).replace(o,function(t){if("%%"===t)return"%";if(n>=i)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}}),c=r[n];n<i;c=r[++n])v(c)||!b(c)?s+=" "+c:s+=" "+a(c);return s},e.deprecate=function(n,o){if(g(t.process))return function(){return e.deprecate(n,o).apply(this,arguments)};if(!0===r.noDeprecation)return n;var i=!1;return function(){if(!i){if(r.throwDeprecation)throw new Error(o);r.traceDeprecation?console.trace(o):console.error(o),i=!0}return n.apply(this,arguments)}};var i,s={};function a(t,n){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(n)?r.showHidden=n:n&&e._extend(r,n),g(r.showHidden)&&(r.showHidden=!1),g(r.depth)&&(r.depth=2),g(r.colors)&&(r.colors=!1),g(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),l(r,t,r.depth)}function c(t,e){var n=a.styles[e];return n?"["+a.colors[n][0]+"m"+t+"["+a.colors[n][1]+"m":t}function u(t,e){return t}function l(t,n,r){if(t.customInspect&&n&&C(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var o=n.inspect(r,t);return y(o)||(o=l(t,o,r)),o}var i=function(t,e){if(g(e))return t.stylize("undefined","undefined");if(y(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}if(_(e))return t.stylize(""+e,"number");if(d(e))return t.stylize(""+e,"boolean");if(v(e))return t.stylize("null","null")}(t,n);if(i)return i;var s=Object.keys(n),a=function(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(n)),E(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return f(n);if(0===s.length){if(C(n)){var c=n.name?": "+n.name:"";return t.stylize("[Function"+c+"]","special")}if(m(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return t.stylize(Date.prototype.toString.call(n),"date");if(E(n))return f(n)}var u,b="",k=!1,j=["{","}"];(h(n)&&(k=!0,j=["[","]"]),C(n))&&(b=" [Function"+(n.name?": "+n.name:"")+"]");return m(n)&&(b=" "+RegExp.prototype.toString.call(n)),w(n)&&(b=" "+Date.prototype.toUTCString.call(n)),E(n)&&(b=" "+f(n)),0!==s.length||k&&0!=n.length?r<0?m(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),u=k?function(t,e,n,r,o){for(var i=[],s=0,a=e.length;s<a;++s)T(e,String(s))?i.push(p(t,e,n,r,String(s),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(p(t,e,n,r,o,!0))}),i}(t,n,r,a,s):s.map(function(e){return p(t,n,r,a,e,k)}),t.seen.pop(),function(t,e,n){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1];return n[0]+e+" "+t.join(", ")+" "+n[1]}(u,b,j)):j[0]+b+j[1]}function f(t){return"["+Error.prototype.toString.call(t)+"]"}function p(t,e,n,r,o,i){var s,a,c;if((c=Object.getOwnPropertyDescriptor(e,o)||{value:e[o]}).get?a=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(a=t.stylize("[Setter]","special")),T(r,o)||(s="["+o+"]"),a||(t.seen.indexOf(c.value)<0?(a=v(n)?l(t,c.value,null):l(t,c.value,n-1)).indexOf("\n")>-1&&(a=i?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),g(s)){if(i&&o.match(/^\d+$/))return a;(s=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+a}function h(t){return Array.isArray(t)}function d(t){return"boolean"==typeof t}function v(t){return null===t}function _(t){return"number"==typeof t}function y(t){return"string"==typeof t}function g(t){return void 0===t}function m(t){return b(t)&&"[object RegExp]"===k(t)}function b(t){return"object"==typeof t&&null!==t}function w(t){return b(t)&&"[object Date]"===k(t)}function E(t){return b(t)&&("[object Error]"===k(t)||t instanceof Error)}function C(t){return"function"==typeof t}function k(t){return Object.prototype.toString.call(t)}function j(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(g(i)&&(i=r.env.NODE_DEBUG||""),t=t.toUpperCase(),!s[t])if(new RegExp("\\b"+t+"\\b","i").test(i)){var n=r.pid;s[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,r)}}else s[t]=function(){};return s[t]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=h,e.isBoolean=d,e.isNull=v,e.isNullOrUndefined=function(t){return null==t},e.isNumber=_,e.isString=y,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=g,e.isRegExp=m,e.isObject=b,e.isDate=w,e.isError=E,e.isFunction=C,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=n(25);var P=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,n;console.log("%s - %s",(t=new Date,n=[j(t.getHours()),j(t.getMinutes()),j(t.getSeconds())].join(":"),[t.getDate(),P[t.getMonth()],n].join(" ")),e.format.apply(e,arguments))},e.inherits=n(24),e._extend=function(t,e){if(!e||!b(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}}).call(this,n(1),n(0))},function(t,e,n){const r=n(5),o=n(4),i=n(8),s=n(23),a=n(22),c=n(21),u=n(3),l=n(20);var f=function(t,e,n){this.board=t,this.logic=e,this.view=n,this.state={rewards:{},activeRewards:[],mode:r.NORMAL,position:this.logic.getPosition(),player:a.PLAYER_SIDE,maxRankedMoves:a.MAX_RANKED_MOVES,stockfishLevel:a.STOCKFISH_LEVEL},this.logic.setStockfishLevel(this.state.stockfishLevel),this.rewardTypes=function(t){const e=new Array;for(var n in t)t.hasOwnProperty(n)&&e.push(t[n].id);return e}(c)};f.prototype.getMode=function(){return this.state.mode},f.prototype.setMode=function(t){if(!r[t])throw new Error(o.INVALID_MODE);this.state.mode=t,this.updateBoard()},f.prototype.setPosition=function(t){this.state.position=t,this.board.position(t)},f.prototype.chooseReward=function(){const t=Math.floor(Math.random()*this.rewardTypes.length),e=this.rewardTypes[t];return c[e]},f.prototype.rewardPlayer=function(t){if(!t)t=this.chooseReward();this.state.rewards[t.id]?this.state.rewards[t.id]+=1:this.state.rewards[t.id]=1,this.view.addReward(t.id,t.description)},f.prototype.useReward=function(t){const e=$(t).attr("data");if(console.log(this.state.rewards),!this.state.rewards[e])throw new Error(o.REWARD_REMOVAL_EXCEPTION);this.canActivateReward(e)?this.activateReward(e,t):console.log("Can't activate award!")},f.prototype.canActivateReward=function(t){return!this.state.activeRewards.includes(t)},f.prototype.activateReward=function(t,e){switch(this.state.rewards[t]-=1,this.state.activeRewards.push(t),t){case c.MAX_FIVE_CHOICES.id:this.state.maxRankedMoves=5;break;case c.SERVER_CHOOSES_BEST_MOVE.id:break;default:throw new Error(o.INVALID_REWARD)}this.view.removeReward(e)},f.prototype.clearActiveRewards=function(){this.state.activeRewards=[]},f.prototype.choosePlayerMove=function(t,e){if(this.state.activeRewards.includes(c.SERVER_CHOOSES_BEST_MOVE.id)){const t=e[e.length-1];var n={from:t.from,to:t.to};console.log("Make this server move: ")}else n=t[1];console.log(n),this.move(n)},f.prototype.submitForRankMode=function(){if(console.log(this.state.activeRewards),0===this.board.getNumMoveChoices())return;this.board.freezeRankings(),this.board.removeAnnotations();const t=this.board.getRankedMoves(),e=i.convertObjectToArray(t),n=this;var o;l.mapSeries(e,function(t){return n.logic.evaluateMove(t)}).then(function(t){return i.sortMovesByScore(t),o=t,n.showFeedbackForMoves(t)}).then(function(){i.isCorrectRanking(o)&&n.rewardPlayer(),n.choosePlayerMove(t,o),n.resetStateAfterRankMode(),n.setMode(r.AFTER_RANK)})},f.prototype.resetStateAfterRankMode=function(){this.state.player=a.PLAYER_SIDE,this.state.maxRankedMoves=a.MAX_RANKED_MOVES,this.clearActiveRewards()},f.prototype.submitForAfterRankMode=function(){clearTimeout(this.afterRankTimeout),this.setMode(r.OPPONENT)},f.prototype.showFeedbackForMoves=function(t){const e=this;return l.mapSeries(t,function(t,n,r){const o=r-n,a=i.getScoreEmoji(t.score);return e.board.annotate(t.from,null,o,a,s.ANNOTATION_LIFETIME,function(){$(this).prop("Counter",0).animate({Counter:t.score},{duration:Math.max(500,10*t.score),easing:"swing",step:function(t){const e=Math.ceil(t),n=e>=0?"+":"";$(this).text(n+e)}})})})},f.prototype.move=function(t){this.logic.updatePosition(t),this.setPosition(this.logic.getPosition())},f.prototype.updateBoard=function(){switch(this.state.mode){case r.NORMAL:this.resetBoard(),this.updateBoardForNormalMode();break;case r.GUESS:break;case r.RANK:this.resetBoard(),this.updateBoardForRankMode();break;case r.OPPONENT:this.resetBoard(),this.updateBoardForOpponentMode();break;case r.AFTER_RANK:this.updateBoardForAfterRankMode();break;default:throw new Error(o.INVALID_MODE)}},f.prototype.updateBoardForNormalMode=function(){const t=this;var e=null;this.board.setOnDragStart(function(e,n,r,o){if(!0===t.logic.game.in_checkmate())return console.log("checkmate"),!1;if(!0===t.logic.game.in_draw())return console.log("draw"),!1;const i="white"===t.state.player?/^b/:/^w/;return-1!==n.search(i)?(console.log("wrong piece color"),!1):void 0}),this.board.setOnDrop(function(n,r,o,i,s,a){console.log("On drop normal");const c={from:n,to:r,promotion:"q"};if(!t.logic.isLegalMove(c))return console.log("snapback normal in onDrop"),console.log(t.logic.game.ascii()),"snapback";e=c}),this.board.setOnSnapEnd(function(){console.log("Snap end normal"),u(null!==e),t.move(e),t.setMode(r.OPPONENT)})},f.prototype.updateBoardForOpponentMode=function(){const t=this;this.preventDragging(),this.logic.getNextBestMove(this.state.position).then(function(e){console.log(e),t.move(e)}).then(function(){console.log(t.logic.game.ascii())}).then(function(){t.setMode(r.RANK)})},f.prototype.updateBoardForRankMode=function(){this.turnOnRankMode()},f.prototype.updateBoardForAfterRankMode=function(){this.preventDragging(),this.afterRankTimeout=setTimeout(this.setMode.bind(this),a.AFTER_RANK_WAIT_TIME,r.OPPONENT)},f.prototype.preventDragging=function(){this.board.setOnDragStart(function(t,e,n,r){return!1})},f.prototype.turnOnRankMode=function(){const t=this;this.board.setAddGhost(!0),this.board.allowReranking(),this.board.setOnDragStart(function(e,n,r,o){if(t.board.getNumMoveChoices()>=t.state.maxRankedMoves)return t.board.annotate(e,"No more choices left!",null,null,750),!1;if(!0===t.logic.game.in_checkmate())return console.log("checkmate"),!1;if(!0===t.logic.game.in_draw())return console.log("draw"),!1;const i="white"===t.state.player?/^b/:/^w/;return-1!==n.search(i)?(console.log("wrong piece color"),!1):void 0}),this.board.setOnDrop(function(e,n,r,o,i,s){const a={from:e,to:n,promotion:"q"};if(!t.logic.isLegalMove(a))return"snapback";setTimeout(t.board.position,250,i)})},f.prototype.resetBoard=function(){this.board.setAddGhost(!1),this.board.freezeRankings(),this.board.clearMoveChoices(),this.board.removeAnnotations(),this.board.removeShadedSquares(),this.board.removeGhosts(),this.board.setOnDragStart(null),this.board.setOnSnapEnd(null),this.board.setOnDrop(null)},t.exports=f},function(t,e,n){(function(t){function n(t,e){for(var n=0,r=t.length-1;r>=0;r--){var o=t[r];"."===o?t.splice(r,1):".."===o?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(t){return r.exec(t).slice(1)};function i(t,e){if(t.filter)return t.filter(e);for(var n=[],r=0;r<t.length;r++)e(t[r],r,t)&&n.push(t[r]);return n}e.resolve=function(){for(var e="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var s=o>=0?arguments[o]:t.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(e=s+"/"+e,r="/"===s.charAt(0))}return e=n(i(e.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+e||"."},e.normalize=function(t){var r=e.isAbsolute(t),o="/"===s(t,-1);return(t=n(i(t.split("/"),function(t){return!!t}),!r).join("/"))||r||(t="."),t&&o&&(t+="/"),(r?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(i(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,n){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=e.resolve(t).substr(1),n=e.resolve(n).substr(1);for(var o=r(t.split("/")),i=r(n.split("/")),s=Math.min(o.length,i.length),a=s,c=0;c<s;c++)if(o[c]!==i[c]){a=c;break}var u=[];for(c=a;c<o.length;c++)u.push("..");return(u=u.concat(i.slice(a))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){var e=o(t),n=e[0],r=e[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},e.basename=function(t,e){var n=o(t)[2];return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},e.extname=function(t){return o(t)[3]};var s="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}).call(this,n(0))},function(t,e,n){n(28);const r=n(27),o=(n(4),n(5)),i=n(18),s=n(12),a=n(11),c=n(9);var u=function(){this.boardDomId="board",this.rewardsPanelDomId="rewardsPanel",this.board=a(this.boardDomId),this.view=new c(this.rewardsPanelDomId),this.logic=new i,this.model=new r(this.board,this.logic,this.view),this.controller=new s(this.model,this.boardDomId)};u.prototype.start=function(){this.model.setMode(o.RANK)},t.exports=u},function(t,e,n){(new(n(29))).start()}]);